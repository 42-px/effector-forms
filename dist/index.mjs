import{combine as e,createStore as r,createEvent as i,sample as s,merge as o}from"effector";import{useUnit as n}from"effector-react";const t={store:function({init:e,domain:i,existing:s},o){return s||(i?i.createStore(e,{and:o,sid:"-efg263"}):r(e,{and:o,sid:"-dyefrw"}))},event:function({domain:e,existing:r}){return r||(e?e.createEvent({sid:"-y6riru"}):i({sid:"-y6rh7v"}))}};function a(r,i,s){var o,n,a,d,l,u,c,m,v,f,h,$;const g="function"==typeof i.init?i.init():i.init,V=t.store({domain:s,existing:null===(o=i.units)||void 0===o?void 0:o.$value,init:g},{and:{sid:`${r}-$value`},name:"$value",sid:"-qmuyz8"}),x=t.store({domain:s,existing:null===(n=i.units)||void 0===n?void 0:n.$errors,init:[]},{and:{sid:`${r}-$errors`},name:"$errors",sid:"-vpp9qr"}),E=x.map((e=>e[0]?e[0]:null)),p=t.store({domain:s,existing:null===(a=i.units)||void 0===a?void 0:a.$initValue,init:g},{and:{sid:`${r}-$initValue`},name:"$initValue",sid:"yr2fi7"}),y=t.store({domain:s,existing:null===(d=i.units)||void 0===d?void 0:d.$isTouched,init:!1},{and:{sid:`${r}-$touched`},name:"$touched",sid:"-q2zc60"}),T=e({and:[V,p,(e,r)=>e!==r],or:{name:"$isDirty",sid:"cgx1r6"}}),k=t.event({domain:s,existing:null===(l=i.units)||void 0===l?void 0:l.onChange},{name:"onChange",sid:"fko8ie"}),F=t.event({domain:s,existing:null===(u=i.units)||void 0===u?void 0:u.onBlur},{name:"onBlur",sid:"-kwhocu"}),b=t.event({domain:s,existing:null===(c=i.units)||void 0===c?void 0:c.changed},{name:"changed",sid:"svcdu2"}),w=t.event({domain:s,existing:null===(m=i.units)||void 0===m?void 0:m.addError},{name:"addError",sid:"utax3x"}),D=t.event({domain:s,existing:null===(v=i.units)||void 0===v?void 0:v.validate},{name:"validate",sid:"-al4q5y"}),j=t.event({domain:s,existing:null===(f=i.units)||void 0===f?void 0:f.resetErrors},{name:"resetErrors",sid:"-8bnwk6"}),q=t.event({domain:s,existing:null===(h=i.units)||void 0===h?void 0:h.resetValue},{name:"resetValue",sid:"-5k4ef5"}),S=t.event({domain:s,existing:null===($=i.units)||void 0===$?void 0:$.reset},{name:"reset",sid:"-t5gx88"}),O=E.map((e=>null===e)),B=E.map((e=>(null==e?void 0:e.errorText)||"")),C=e({and:[{value:V,errors:x,firstError:E,isValid:O,isDirty:T,isTouched:y}],or:{name:"$field",sid:"-3lcsvv"}}),I={value:V,initValue:p,isValid:O,isDirty:T,touched:y,errors:x,firstError:E,errorText:B,onChange:k,onBlur:F,addError:w,validate:D,reset:S,resetErrors:j,resetValue:q};return{changed:b,name:r,$initValue:p,$value:V,$errors:x,$firstError:E,$errorText:B,$isValid:O,$isDirty:T,$isTouched:y,$touched:y,$field:C,onChange:k,onBlur:F,addError:w,validate:D,set:k,reset:S,resetErrors:j,resetValue:q,filter:i.filter,"@@unitShape":()=>I}}function d(i,n){const{form:t,field:a,fieldConfig:d}=i,l=d.rules||[],u=t.validateOn||["submit"],c=d.validateOn||[],{$value:m,$errors:v,onBlur:f,changed:h,addError:$,validate:g,resetErrors:V,resetValue:x,reset:E}=a,p="function"==typeof l?r([],{and:{sid:`${a.name}-$rulesSources`},name:"rulesSources",sid:"8mhplv"}):e({and:[l.map((({source:e},i)=>{const s=`${a.name}-$rulesSources-${i}`;return e||r(null,{and:{sid:s},sid:"kjwg5z"})}))],or:{name:"rulesSources",sid:"93jc02"}}),y=(T=l,(e,r,i)=>{const s=[],o="function"==typeof T?T(e,r):T;for(let n=0;n<o.length;n++){const t=o[n],a=i?i[n]:null,d=t.validator(e,r,a);"boolean"!=typeof d||d||s.push({rule:t.name,errorText:t.errorText,value:e}),"object"!=typeof d||d.isValid||s.push({rule:t.name,errorText:d.errorText,value:e})}return s});var T;const k=[...u,...c],F=[];if(k.includes("submit")){const r=s({and:[{source:e({and:[{fieldValue:m,form:t.$values,rulesSources:p}],or:{name:"source",sid:"a7in27"}}),clock:t.submit}],or:{name:"validationTrigger",sid:"ag2jep"}});F.push(r)}k.includes("blur")&&F.push(s({and:[{source:e({and:[{fieldValue:m,form:t.$values,rulesSources:p}],or:{name:"source",sid:"pcyjof"}}),clock:f}],or:{sid:"-mjjw0q"}})),k.includes("change")&&F.push(s({and:[{source:e({and:[{fieldValue:m,form:t.$values,rulesSources:p}],or:{name:"source",sid:"-uzr82o"}}),clock:o([h,x,t.resetValues],{name:"clock",sid:"mklqro"})}],or:{sid:"-7v5lsp"}})),F.push(s({and:[{source:e({and:[{fieldValue:m,form:t.$values,rulesSources:p}],or:{name:"source",sid:"-gsekud"}}),clock:g}],or:{sid:"6c71fm"}})),F.push(s({and:[{source:e({and:[{fieldValue:m,form:t.$values,rulesSources:p}],or:{name:"source",sid:"-323jeq"}}),clock:t.validate}],or:{sid:"a4k0l6"}}));const b=s({and:[{source:m,clock:$,fn:(e,{rule:r,errorText:i})=>({rule:r,value:e,errorText:i})}],or:{name:"addErrorWithValue",sid:"symbs8"}}),w=s({and:[{source:m,clock:t.addErrors,fn:(e,r)=>({value:e,newErrors:r})}],or:{name:"addErrorsWithValue",sid:"-6mh24c"}});v.on(F,((e,{form:r,fieldValue:i,rulesSources:s})=>y(i,r,s))).on(b,((e,r)=>[r,...e])).on(w,((e,{value:r,newErrors:i})=>{const s=[];for(const e of i)e.field===a.name&&s.push({value:r,rule:e.rule,errorText:e.errorText});return[...s,...e]})).reset(V,t.reset,E,t.resetErrors),k.includes("change")||v.reset(h)}function l({field:e,form:r}){const{$value:i,$initValue:n,$touched:t,onChange:a,changed:d,name:l,reset:u,resetValue:c,filter:m}=e,{setForm:v,setInitialForm:f,resetForm:h,resetTouched:$,resetValues:g}=r,V=s({and:[{source:n,clock:o([u,c,g,h],{name:"clock",sid:"3kodws"})}],or:{name:"resetValueWithInit",sid:"oge6qb"}});t.on(d,(()=>!0)).reset(u,h,$),s(m?{and:[{source:a,filter:m,target:d}],or:{sid:"-kvl8n2"}}:{and:[{source:a,filter:()=>!0,target:d}],or:{sid:"-kg700y"}}),n.on(f,((e,r)=>r.hasOwnProperty(l)?r[l]:e)),i.on(d,((e,r)=>r)).on([v,f],((e,r)=>r.hasOwnProperty(l)?r[l]:e)).on(V,((e,r)=>r))}function u(r){const{filter:i,domain:o,fields:n,validateOn:u,units:c}=r,m={},v=[],f=[];for(const e in n){if(!n.hasOwnProperty(e))continue;const r=a(e,n[e],o);m[e]=r,v.push(r.$isDirty),f.push(r.$touched)}const h=function(r){const i={};for(const e in r)r.hasOwnProperty(e)&&(i[e]=r[e].$value);return e({and:[i],or:{sid:"39yu4w"}})}(m),$=function(r){const i=[];for(const e in r){if(!r.hasOwnProperty(e))continue;const{$firstError:s}=r[e];i.push(s)}return e({and:[i],or:{name:"$firstErrors",sid:"-1vosn1"}}).map((e=>e.every((e=>null===e))))}(m),g=i?e({and:[$,i,(e,r)=>e&&r],or:{name:"$isFormValid",sid:"j5pxai"}}):$,V=e({and:[v],or:{name:"$isDirty",sid:"il8stq"}}).map((e=>e.some(Boolean))),x=e({and:[f],or:{name:"$touched",sid:"2no1yv"}}).map((e=>e.some(Boolean))),E=e({and:[{isValid:$,isDirty:V,touched:x}],or:{name:"$meta",sid:"yii6e7"}}),p=t.event({domain:o,existing:null==c?void 0:c.validate},{name:"validate",sid:"5z7ulc"}),y=t.event({domain:o,existing:null==c?void 0:c.submit},{name:"submitForm",sid:"-xys7v0"}),T=t.event({domain:o,existing:null==c?void 0:c.formValidated},{name:"formValidated",sid:"-2r221i"}),k=t.event({domain:o,existing:null==c?void 0:c.setInitialForm},{name:"setInitialForm",sid:"-q10ho7"}),F=t.event({domain:o,existing:null==c?void 0:c.setForm},{name:"setForm",sid:"l2bjv0"}),b=t.event({domain:o,existing:null==c?void 0:c.addErrors},{name:"addErrors",sid:"n5fjqj"}),w=t.event({domain:o,existing:null==c?void 0:c.reset},{name:"resetForm",sid:"pfltj4"}),D=t.event({domain:o,existing:null==c?void 0:c.resetValues},{name:"resetValues",sid:"-s67s76"}),j=t.event({domain:o,existing:null==c?void 0:c.resetErrors},{name:"resetErrors",sid:"hulqf7"}),q=t.event({domain:o,existing:null==c?void 0:c.resetTouched},{name:"resetTouched",sid:"2gwck3"}),S=s({and:[{source:h,clock:y}],or:{name:"submitWithFormData",sid:"foyubg"}}),O=s({and:[{source:h,clock:p}],or:{name:"validateWithFormData",sid:"-mn7k5o"}});for(const e in m){if(!m.hasOwnProperty(e))continue;const r=n[e],i=m[e];l({form:{setForm:F,setInitialForm:k,resetForm:w,resetTouched:q,resetValues:D},field:i}),d({form:{$values:h,submit:y,reset:w,addErrors:b,resetValues:D,resetErrors:j,validate:p,validateOn:u},fieldConfig:r,field:i})}s({and:[{source:S,filter:g,target:T}],or:{sid:"4sls6r"}}),s({and:[{source:O,filter:g,target:T}],or:{sid:"4vwjqx"}});const B={isValid:$,isDirty:V,touched:x,submit:y,reset:w,addErrors:b,validate:p,setForm:F,setInitialForm:k,resetTouched:q,resetValues:D,resetErrors:j,formValidated:T};return{fields:m,$values:h,$eachValid:$,$isValid:$,$isDirty:V,$touched:x,$meta:E,submit:y,validate:p,resetTouched:q,addErrors:b,reset:w,resetValues:D,resetErrors:j,setForm:F,setInitialForm:k,set:F,formValidated:T,"@@unitShape":()=>B}}function c(e){const{value:r,errors:i,firstError:s,isValid:o,isDirty:t,isTouched:a}=n(e.$field);return{name:e.name,value:r,errors:i,firstError:s,isValid:o,isDirty:t,touched:a,isTouched:a,onChange:n(e.onChange),onBlur:n(e.onBlur),addError:n(e.addError),validate:n(e.validate),reset:n(e.reset),set:n(e.onChange),resetErrors:n(e.resetErrors),hasError:()=>null!==s,errorText:e=>s?e&&e[s.rule]?e[s.rule]:s.errorText||"":""}}function m(e){const r={},i={};for(const s in e.fields){if(!e.fields.hasOwnProperty(s))continue;const o=c(e.fields[s]);r[s]=o,i[s]=o.value}const{isValid:s,isDirty:o,touched:t}=n(e.$meta);return{fields:r,values:i,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!s,eachValid:s,isValid:s,isDirty:o,isTouched:t,touched:t,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,errorText:(e,i)=>{const s=r[e];return s&&s.firstError?i&&i[s.firstError.rule]?i[s.firstError.rule]:s.firstError.errorText||"":""},reset:n(e.reset),submit:n(e.submit),setForm:n(e.setForm),set:n(e.setForm),formValidated:n(e.formValidated)}}export{u as createForm,c as useField,m as useForm};
//# sourceMappingURL=index.mjs.map
