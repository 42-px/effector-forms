"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("effector"),r=require("effector-react");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"==typeof e)return o(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var i={store:function(r){var t=r.init,n=r.domain,o=r.existing;return o||(n?n.store(t):e.createStore(t))},event:function(r){var t=r.domain,n=r.existing;return n||(t?t.event():e.createEvent())}};function u(e,r,t){var n,o,u,s,a,l,d,c,f,v,m,p="function"==typeof r.init?r.init():r.init,h=i.store({domain:t,existing:null===(n=r.units)||void 0===n?void 0:n.$value,init:p}),g=i.store({domain:t,existing:null===(o=r.units)||void 0===o?void 0:o.$errors,init:[]}),y=g.map((function(e){return e[0]?e[0]:null})),b=h.map((function(e){return e!==p})),E=i.store({domain:t,existing:null===(u=r.units)||void 0===u?void 0:u.$isTouched,init:!1}),$=i.event({domain:t,existing:null===(s=r.units)||void 0===s?void 0:s.onChange}),x=i.event({domain:t,existing:null===(a=r.units)||void 0===a?void 0:a.onBlur}),V=i.event({domain:t,existing:null===(l=r.units)||void 0===l?void 0:l.changed}),S=i.event({domain:t,existing:null===(d=r.units)||void 0===d?void 0:d.addError}),T=i.event({domain:t,existing:null===(c=r.units)||void 0===c?void 0:c.validate}),O=i.event({domain:t,existing:null===(f=r.units)||void 0===f?void 0:f.resetErrors}),F=i.event({domain:t,existing:null===(v=r.units)||void 0===v?void 0:v.resetValue}),w=i.event({domain:t,existing:null===(m=r.units)||void 0===m?void 0:m.reset});return{changed:V,name:e,$value:h,$errors:g,$firstError:y,$isValid:y.map((function(e){return null===e})),$isDirty:b,$isTouched:E,$touched:E,onChange:$,onBlur:x,addError:S,validate:T,set:$,reset:w,resetErrors:O,resetValue:F,filter:r.filter}}function s(r){var o,i=r.$form,u=r.validateFormEvent,s=r.submitEvent,a=r.resetFormEvent,l=r.resetValues,d=r.field,c=r.rules,f=r.resetErrors,v=r.formValidationEvents,m=r.fieldValidationEvents,p=d.$value,h=d.$errors,g=d.onBlur,y=d.changed,b=d.addError,E=d.validate,$=d.resetErrors,x=d.resetValue,V=d.reset,S="function"==typeof c?e.createStore([]):e.combine(c.map((function(r){return r.source||e.createStore(null)}))),T=(o=c,function(e,r,n){for(var i=[],u="function"==typeof o?o(e,r):o,s=0;s<u.length;s++){var a=u[s],l=n?n[s]:null,d=a.validator(e,r,l);"boolean"!=typeof d||d||i.push({rule:a.name,errorText:a.errorText,value:e}),"object"!==t(d)||d.isValid||i.push({rule:a.name,errorText:d.errorText,value:e})}return i}),O=[].concat(n(v),n(m)),F=[];O.includes("submit")&&F.push(e.sample({source:e.combine({fieldValue:p,form:i,rulesSources:S}),clock:s})),O.includes("blur")&&F.push(e.sample({source:e.combine({fieldValue:p,form:i,rulesSources:S}),clock:g})),O.includes("change")&&F.push(e.sample({source:e.combine({fieldValue:p,form:i,rulesSources:S}),clock:e.merge([y,x,l])})),F.push(e.sample({source:e.combine({fieldValue:p,form:i,rulesSources:S}),clock:E})),F.push(e.sample({source:e.combine({fieldValue:p,form:i,rulesSources:S}),clock:u}));var w=e.sample({source:p,clock:b,fn:function(e,r){return{rule:r.rule,value:e,errorText:r.errorText}}});h.on(F,(function(e,r){var t=r.form,n=r.fieldValue,o=r.rulesSources;return T(n,t,o)})).on(w,(function(e,r){return[r].concat(n(e))})).reset($,a,V,f),O.includes("change")||h.reset(y)}function a(r,t,n,o,i){var u=r.$value,s=r.$touched,a=r.onChange,l=r.changed,d=r.name,c=r.reset,f=r.resetValue,v=r.filter;s.on(l,(function(){return!0})).reset(c,n,o),e.guard({source:a,filter:v||function(){return!0},target:l}),u.on(l,(function(e,r){return r})).on(t,(function(e,r){return r.hasOwnProperty(d)?r[d]:e})).reset(c,f,i,n)}function l(e){var t=r.useStore(e.$value),n=r.useStore(e.$errors),o=r.useStore(e.$firstError),i=r.useStore(e.$isValid),u=r.useStore(e.$isDirty),s=r.useStore(e.$touched);return{name:e.name,value:t,errors:n,firstError:o,isValid:i,isDirty:u,touched:s,isTouched:s,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:function(){return null!==o},errorText:function(e){return o?e&&e[o.rule]?e[o.rule]:o.errorText||"":""}}}exports.createForm=function(r){var t=r.filter,n=r.domain,o=r.fields,l=r.validateOn,d=r.units,c={},f=[],v=[];for(var m in o)if(o.hasOwnProperty(m)){var p=u(m,o[m],n);c[m]=p,f.push(p.$isDirty),v.push(p.$touched)}var h=function(r){var t={};for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n].$value);return e.combine(t)}(c),g=function(r){var t=[];for(var n in r)if(r.hasOwnProperty(n)){var o=r[n].$firstError;t.push(o)}return e.combine(t).map((function(e){return e.every((function(e){return null===e}))}))}(c),y=t?e.combine(g,t,(function(e,r){return e&&r})):g,b=e.combine(f).map((function(e){return e.some(Boolean)})),E=e.combine(v).map((function(e){return e.some(Boolean)})),$=i.event({domain:n,existing:null==d?void 0:d.validate}),x=i.event({domain:n,existing:null==d?void 0:d.submit}),V=i.event({domain:n,existing:null==d?void 0:d.formValidated}),S=i.event({domain:n,existing:null==d?void 0:d.setForm}),T=i.event({domain:n,existing:null==d?void 0:d.reset}),O=i.event({domain:n,existing:null==d?void 0:d.resetValues}),F=i.event({domain:n,existing:null==d?void 0:d.resetErrors}),w=i.event({domain:n,existing:null==d?void 0:d.resetTouched}),B=e.sample(h,x),A=e.sample(h,$);for(var C in c)if(c.hasOwnProperty(C)){var D=o[C],P=c[C];a(P,S,T,w,O),D.rules&&s({$form:h,rules:D.rules,submitEvent:x,resetFormEvent:T,resetValues:O,resetErrors:F,validateFormEvent:$,field:P,formValidationEvents:l||["submit"],fieldValidationEvents:D.validateOn?D.validateOn:[]})}return e.guard({source:B,filter:y,target:V}),e.guard({source:A,filter:y,target:V}),{fields:c,$values:h,$eachValid:g,$isValid:g,$isDirty:b,$touched:E,submit:x,validate:$,resetTouched:w,reset:T,resetValues:O,resetErrors:F,setForm:S,set:S,formValidated:V}},exports.useField=l,exports.useForm=function(e){var t={};for(var n in e.fields)if(e.fields.hasOwnProperty(n)){var o=e.fields[n];t[n]=l(o)}var i=r.useStore(e.$values),u=r.useStore(e.$eachValid),s=r.useStore(e.$isDirty),a=r.useStore(e.$touched);return{fields:t,values:i,hasError:function(e){return e?!!t[e]&&Boolean(t[e].firstError):!u},eachValid:u,isValid:u,isDirty:s,isTouched:a,touched:a,errors:function(e){return t[e]?t[e].errors:[]},error:function(e){return t[e]?t[e].firstError:null},reset:e.reset,errorText:function(e,r){var n=t[e];return n&&n.firstError?r&&r[n.firstError.rule]?r[n.firstError.rule]:n.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}};
//# sourceMappingURL=effector-forms.cjs.js.map
