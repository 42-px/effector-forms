"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("effector"),r=require("effector-react");function t(r,t,o){const n="function"==typeof t.init?t.init():t.init,s=o?o.store(n):e.createStore(n),i=o?o.store([]):e.createStore([]),a=i.map(e=>e[0]?e[0]:null),u=s.map(e=>e!==n),l=o?o.store(!1):e.createStore(!1),c=o?o.event():e.createEvent(),f=o?o.event():e.createEvent(),d=o?o.event():e.createEvent(),m=o?o.event():e.createEvent(),v=o?o.event():e.createEvent(),h=o?o.event():e.createEvent(),E=o?o.event():e.createEvent();return{changed:d,name:r,$value:s,$errors:i,$firstError:a,$isValid:a.map(e=>null===e),$isDirty:u,$touched:l,onChange:c,onBlur:f,addError:m,validate:v,set:c,reset:E,resetErrors:h,filter:t.filter}}function o({$form:r,submitEvent:t,field:o,rules:n,formValidationEvents:s,fieldValidationEvents:i}){const{$value:a,$errors:u,onBlur:l,changed:c,addError:f,validate:d,resetErrors:m}=o,v=function(e){return(r,t)=>{const o=[];for(const n of e){const e=n.validator(r,t);"boolean"!=typeof e||e||o.push({rule:n.name,value:r}),"object"!=typeof e||e.isValid||o.push({rule:n.name,errorText:e.errorText,value:r})}return o}}(n),h=[...s,...i],E=[];h.includes("submit")&&E.push(e.sample({source:e.combine({fieldValue:a,form:r}),clock:t})),h.includes("blur")&&E.push(e.sample({source:e.combine({fieldValue:a,form:r}),clock:l})),h.includes("change")&&E.push(e.sample({source:e.combine({fieldValue:a,form:r}),clock:c})),E.push(e.sample({source:e.combine({fieldValue:a,form:r}),clock:d}));const p=e.sample({source:a,clock:f,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})});u.on(E,(e,{form:r,fieldValue:t})=>v(t,r)).on(p,(e,r)=>[r,...e]).reset(m),h.includes("change")||u.reset(c)}function n({$value:r,$touched:t,onChange:o,changed:n,name:s,reset:i,filter:a},u,l,c){t.on(n,()=>!0).reset(i,l,c),e.guard({source:o,filter:a||(()=>!0),target:n}),r.on(n,(e,r)=>r).on(u,(e,r)=>r.hasOwnProperty(s)?r[s]:e).reset(i,l)}function s(e){const t=r.useStore(e.$value),o=r.useStore(e.$errors),n=r.useStore(e.$firstError),s=r.useStore(e.$isValid),i=r.useStore(e.$isDirty),a=r.useStore(e.$touched);return{name:e.name,value:t,errors:o,firstError:n,isValid:s,isDirty:i,touched:a,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==n,errorText:e=>n?e&&e[n.rule]?e[n.rule]:n.errorText||"":""}}exports.createForm=function(r){const{filter:s,domain:i,fields:a,validateOn:u}=r,l={},c=[],f=[];for(const e in a){if(!a.hasOwnProperty(e))continue;const r=t(e,a[e],i);l[e]=r,c.push(r.$isDirty),f.push(r.$touched)}const d=function(r){const t={};for(const e in r)r.hasOwnProperty(e)&&(t[e]=r[e].$value);return e.combine(t)}(l),m=function(r){const t=[];for(const e in r){if(!r.hasOwnProperty(e))continue;const{$firstError:o}=r[e];t.push(o)}return e.combine(t).map(e=>e.every(e=>null===e))}(l),v=s?e.combine(m,s,(e,r)=>e&&r):m,h=e.combine(c).map(e=>e.some(Boolean)),E=e.combine(f).map(e=>e.some(Boolean)),p=i?i.event():e.createEvent(),$=i?i.event():e.createEvent(),V=i?i.event():e.createEvent(),b=i?i.event():e.createEvent(),y=i?i.event():e.createEvent(),g=e.sample(d,p);for(const e in l){if(!l.hasOwnProperty(e))continue;const r=a[e],t=l[e];n(t,V,b,y),r.rules&&o({$form:d,rules:r.rules,submitEvent:p,field:t,formValidationEvents:u||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return e.guard({source:g,filter:v,target:$}),{fields:l,$values:d,$eachValid:m,$isValid:m,$isDirty:h,$touched:E,submit:p,resetTouched:y,reset:b,setForm:V,set:V,formValidated:$}},exports.useField=s,exports.useForm=function(e){const t={};for(const r in e.fields){if(!e.fields.hasOwnProperty(r))continue;const o=e.fields[r];t[r]=s(o)}const o=r.useStore(e.$values),n=r.useStore(e.$eachValid),i=r.useStore(e.$isDirty),a=r.useStore(e.$touched);return{fields:t,values:o,hasError:e=>e?!!t[e]&&Boolean(t[e].firstError):!n,eachValid:n,isValid:n,isDirty:i,touched:a,errors:e=>t[e]?t[e].errors:[],error:e=>t[e]?t[e].firstError:null,reset:e.reset,errorText:(e,r)=>{const o=t[e];return o&&o.firstError?r&&r[o.firstError.rule]?r[o.firstError.rule]:o.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}};
//# sourceMappingURL=effector-forms.cjs.js.map
