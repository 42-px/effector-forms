var EffectorForm=function(e,r,t){"use strict";function o(e,t,o){const n="function"==typeof t.init?t.init():t.init,s=o?o.store(n):r.createStore(n),a=o?o.store([]):r.createStore([]),i=a.map(e=>e[0]?e[0]:null),l=o?o.event():r.createEvent(),u=o?o.event():r.createEvent(),c=o?o.event():r.createEvent(),f=o?o.event():r.createEvent(),d=o?o.event():r.createEvent(),m=o?o.event():r.createEvent();return{name:e,$value:s,$errors:a,$firstError:i,$isValid:i.map(e=>null===e),onChange:l,onBlur:u,addError:c,validate:f,set:l,reset:m,resetErrors:d}}function n({$form:e,submitEvent:t,field:o,rules:n,formValidationEvents:s,fieldValidationEvents:a}){const{$value:i,$errors:l,onBlur:u,onChange:c,addError:f,validate:d,resetErrors:m}=o,v=function(e){return(r,t)=>{const o=[];for(const n of e){const e=n.validator(r,t);"boolean"!=typeof e||e||o.push({rule:n.name,value:r}),"object"!=typeof e||e.isValid||o.push({rule:n.name,errorText:e.errorText,value:r})}return o}}(n),E=[...s,...a],h=[];E.includes("submit")&&h.push(r.sample({source:r.combine({fieldValue:i,form:e}),clock:t})),E.includes("blur")&&h.push(r.sample({source:r.combine({fieldValue:i,form:e}),clock:u})),E.includes("change")&&h.push(r.sample({source:r.combine({fieldValue:i,form:e}),clock:c})),h.push(r.sample({source:r.combine({fieldValue:i,form:e}),clock:d}));const p=r.sample({source:i,clock:f,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})});l.on(h,(e,{form:r,fieldValue:t})=>v(t,r)).on(p,(e,r)=>[r,...e]).reset(m),E.includes("change")||l.reset(c)}function s({$value:e,onChange:r,name:t,reset:o},n,s){e.on(r,(e,r)=>r).on(n,(e,r)=>r.hasOwnProperty(t)?r[t]:e).reset(o,s)}function a(e){const r=t.useStore(e.$value),o=t.useStore(e.$errors),n=t.useStore(e.$firstError),s=t.useStore(e.$isValid);return{name:e.name,value:r,errors:o,firstError:n,isValid:s,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==n,errorText:e=>n?e&&e[n.rule]?e[n.rule]:n.errorText||"":""}}return e.createForm=function(e){const{filter:t,domain:a,fields:i,validateOn:l}=e,u={};for(const e in i){if(!i.hasOwnProperty(e))continue;const r=i[e];u[e]=o(e,r,a)}const c=function(e){const t={};for(const r in e)e.hasOwnProperty(r)&&(t[r]=e[r].$value);return r.combine(t)}(u),f=function(e){const t=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const{$firstError:o}=e[r];t.push(o)}return r.combine(t).map(e=>e.every(e=>null===e))}(u),d=t?r.combine(f,t,(e,r)=>e&&r):f,m=a?a.event():r.createEvent(),v=a?a.event():r.createEvent(),E=a?a.event():r.createEvent(),h=a?a.event():r.createEvent(),p=r.sample(c,m);for(const e in u){if(!u.hasOwnProperty(e))continue;const r=i[e],t=u[e];s(t,E,h),r.rules&&n({$form:c,rules:r.rules,submitEvent:m,field:t,formValidationEvents:l||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return r.guard({source:p,filter:d,target:v}),{fields:u,$values:c,$eachValid:f,$isValid:f,submit:m,reset:h,setForm:E,set:E,formValidated:v}},e.useField=a,e.useForm=function(e){const r={};for(const t in e.fields){if(!e.fields.hasOwnProperty(t))continue;const o=e.fields[t];r[t]=a(o)}const o=t.useStore(e.$values),n=t.useStore(e.$eachValid);return{fields:r,values:o,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!n,eachValid:n,isValid:n,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,reset:e.reset,errorText:(e,t)=>{const o=r[e];return o&&o.firstError?t&&t[o.firstError.rule]?t[o.firstError.rule]:o.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}},e}({},effector,effectorReact);
//# sourceMappingURL=effector-forms.iife.js.map
