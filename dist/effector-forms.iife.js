var EffectorForm=function(e,r,t){"use strict";const i={store:function({init:e,domain:t,existing:i}){return i||(t?t.store(e):r.createStore(e))},event:function({domain:e,existing:t}){return t||(e?e.event():r.createEvent())}};function o(e,t,o){var n,s,l,u,a,d,c,m,v,f,h;const g="function"==typeof t.init?t.init():t.init,E=i.store({domain:o,existing:null===(n=t.units)||void 0===n?void 0:n.$value,init:g}),p=i.store({domain:o,existing:null===(s=t.units)||void 0===s?void 0:s.$errors,init:[]}),V=p.map(e=>e[0]?e[0]:null),x=E.map(e=>e!==g),$=i.store({domain:o,existing:null===(l=t.units)||void 0===l?void 0:l.$isTouched,init:!1}),b=i.event({domain:o,existing:null===(u=t.units)||void 0===u?void 0:u.onChange}),y=i.event({domain:o,existing:null===(a=t.units)||void 0===a?void 0:a.onBlur}),T=i.event({domain:o,existing:null===(d=t.units)||void 0===d?void 0:d.changed}),F=i.event({domain:o,existing:null===(c=t.units)||void 0===c?void 0:c.addError}),S=i.event({domain:o,existing:null===(m=t.units)||void 0===m?void 0:m.validate}),D=i.event({domain:o,existing:null===(v=t.units)||void 0===v?void 0:v.resetErrors}),O=i.event({domain:o,existing:null===(f=t.units)||void 0===f?void 0:f.resetValue}),B=i.event({domain:o,existing:null===(h=t.units)||void 0===h?void 0:h.reset}),k=V.map(e=>null===e);return{changed:T,name:e,$value:E,$errors:p,$firstError:V,$isValid:k,$isDirty:x,$isTouched:$,$touched:$,$field:r.combine({value:E,errors:p,firstError:V,isValid:k,isDirty:x,isTouched:$}),onChange:b,onBlur:y,addError:F,validate:S,set:b,reset:B,resetErrors:D,resetValue:O,filter:t.filter}}function n({$form:e,validateFormEvent:t,submitEvent:i,resetFormEvent:o,resetValues:n,field:s,rules:l,resetErrors:u,formValidationEvents:a,fieldValidationEvents:d}){const{$value:c,$errors:m,onBlur:v,changed:f,addError:h,validate:g,resetErrors:E,resetValue:p,reset:V}=s,x="function"==typeof l?r.createStore([]):r.combine(l.map(({source:e})=>e||r.createStore(null))),$=(b=l,(e,r,t)=>{const i=[],o="function"==typeof b?b(e,r):b;for(let n=0;n<o.length;n++){const s=o[n],l=t?t[n]:null,u=s.validator(e,r,l);"boolean"!=typeof u||u||i.push({rule:s.name,errorText:s.errorText,value:e}),"object"!=typeof u||u.isValid||i.push({rule:s.name,errorText:u.errorText,value:e})}return i});var b;const y=[...a,...d],T=[];if(y.includes("submit")){const t=r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:x}),clock:i});T.push(t)}y.includes("blur")&&T.push(r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:x}),clock:v})),y.includes("change")&&T.push(r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:x}),clock:r.merge([f,p,n])})),T.push(r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:x}),clock:g})),T.push(r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:x}),clock:t}));const F=r.sample({source:c,clock:h,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})});m.on(T,(e,{form:r,fieldValue:t,rulesSources:i})=>$(t,r,i)).on(F,(e,r)=>[r,...e]).reset(E,o,V,u),y.includes("change")||m.reset(f)}function s({$value:e,$touched:t,onChange:i,changed:o,name:n,reset:s,resetValue:l,filter:u},a,d,c,m){t.on(o,()=>!0).reset(s,d,c),r.guard({source:i,filter:u||(()=>!0),target:o}),e.on(o,(e,r)=>r).on(a,(e,r)=>r.hasOwnProperty(n)?r[n]:e).reset(s,l,m,d)}function l(e){const{value:r,errors:i,firstError:o,isValid:n,isDirty:s,isTouched:l}=t.useStore(e.$field);return{name:e.name,value:r,errors:i,firstError:o,isValid:n,isDirty:s,touched:l,isTouched:l,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==o,errorText:e=>o?e&&e[o.rule]?e[o.rule]:o.errorText||"":""}}return e.createForm=function(e){const{filter:t,domain:l,fields:u,validateOn:a,units:d}=e,c={},m=[],v=[];for(const e in u){if(!u.hasOwnProperty(e))continue;const r=o(e,u[e],l);c[e]=r,m.push(r.$isDirty),v.push(r.$touched)}const f=function(e){const t={};for(const r in e)e.hasOwnProperty(r)&&(t[r]=e[r].$value);return r.combine(t)}(c),h=function(e){const t=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const{$firstError:i}=e[r];t.push(i)}return r.combine(t).map(e=>e.every(e=>null===e))}(c),g=t?r.combine(h,t,(e,r)=>e&&r):h,E=r.combine(m).map(e=>e.some(Boolean)),p=r.combine(v).map(e=>e.some(Boolean)),V=r.combine({isValid:h,isDirty:E,touched:p}),x=i.event({domain:l,existing:null==d?void 0:d.validate}),$=i.event({domain:l,existing:null==d?void 0:d.submit}),b=i.event({domain:l,existing:null==d?void 0:d.formValidated}),y=i.event({domain:l,existing:null==d?void 0:d.setForm}),T=i.event({domain:l,existing:null==d?void 0:d.reset}),F=i.event({domain:l,existing:null==d?void 0:d.resetValues}),S=i.event({domain:l,existing:null==d?void 0:d.resetErrors}),D=i.event({domain:l,existing:null==d?void 0:d.resetTouched}),O=r.sample(f,$),B=r.sample(f,x);for(const e in c){if(!c.hasOwnProperty(e))continue;const r=u[e],t=c[e];s(t,y,T,D,F),r.rules&&n({$form:f,rules:r.rules,submitEvent:$,resetFormEvent:T,resetValues:F,resetErrors:S,validateFormEvent:x,field:t,formValidationEvents:a||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return r.guard({source:O,filter:g,target:b}),r.guard({source:B,filter:g,target:b}),{fields:c,$values:f,$eachValid:h,$isValid:h,$isDirty:E,$touched:p,$meta:V,submit:$,validate:x,resetTouched:D,reset:T,resetValues:F,resetErrors:S,setForm:y,set:y,formValidated:b}},e.useField=l,e.useForm=function(e){const r={},i={};for(const t in e.fields){if(!e.fields.hasOwnProperty(t))continue;const o=l(e.fields[t]);r[t]=o,i[t]=o.value}const{isValid:o,isDirty:n,touched:s}=t.useStore(e.$meta);return{fields:r,values:i,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!o,eachValid:o,isValid:o,isDirty:n,isTouched:s,touched:s,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,reset:e.reset,errorText:(e,t)=>{const i=r[e];return i&&i.firstError?t&&t[i.firstError.rule]?t[i.firstError.rule]:i.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}},e}({},effector,effectorReact);
//# sourceMappingURL=effector-forms.iife.js.map
