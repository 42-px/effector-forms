!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("effector")):"function"==typeof define&&define.amd?define(["exports","effector"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).EffectorForm={},e.effector)}(this,(function(e,n){"use strict";function t(e,t,o){const r="function"==typeof t.init?t.init():t.init,i=o?o.store(r):n.createStore(r),a=o?o.store([]):n.createStore([]),s=a.map(e=>e[0]?e[0]:null);return{name:e,$value:i,$errors:a,$firstError:s,onChange:o?o.event():n.createEvent(),onBlur:o?o.event():n.createEvent()}}function o({$form:e,submitEvent:t,field:o,rules:r,formValidationEvents:i,fieldValidationEvents:a}){const{$value:s,$errors:l,onBlur:c,onChange:u}=o,f=function(e){return(n,t)=>{const o=[];for(const r of e){const e=r.validator(n,t);"boolean"!=typeof e||e||o.push({rule:r.name,value:n}),"object"!=typeof e||e.isValid||o.push({rule:r.name,errorText:e.errorText,value:n})}return o}}(r),d=[...i,...a],m=[];d.includes("submit")&&m.push(n.sample({source:n.combine({fieldValue:s,form:e}),clock:t})),d.includes("blur")&&m.push(n.sample({source:n.combine({fieldValue:s,form:e}),clock:c})),d.includes("change")&&m.push(n.sample({source:n.combine({fieldValue:s,form:e}),clock:u})),l.on(m,(e,{form:n,fieldValue:t})=>f(t,n)),d.includes("change")||l.reset(u)}function r({$value:e,onChange:n,name:t},o){e.on(n,(e,n)=>n).on(o,(e,n)=>n.hasOwnProperty(t)?n[t]:e)}function i(e){const{filter:i,domain:a,fields:s,validateOn:l}=e,c={};for(const e in s){if(!s.hasOwnProperty(e))continue;const n=s[e];c[e]=t(e,n,a)}const u=function(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n].$value);return n.combine(t)}(c),f=function(e){const t=[];for(const n in e){if(!e.hasOwnProperty(n))continue;const{$firstError:o}=e[n];t.push(o)}return n.combine(t).map(e=>e.every(e=>null===e))}(c),d=i?n.combine(f,i,(e,n)=>e&&n):f,m=a?a.event():n.createEvent(),v=a?a.event():n.createEvent(),p=a?a.event():n.createEvent(),b=n.sample(u,m);for(const e in c){if(!c.hasOwnProperty(e))continue;const n=s[e],t=c[e];r(t,p),n.rules&&o({$form:u,rules:n.rules,submitEvent:m,field:t,formValidationEvents:l||["submit"],fieldValidationEvents:n.validateOn?n.validateOn:[]})}return n.guard({source:b,filter:d,target:v}),{fields:c,$values:u,$eachValid:f,submit:m,setForm:p,formValidated:v}}const a=()=>({name:"required",validator:e=>Boolean(e)}),s=n.createEffect(),l=n.createStore(null);l.on(s.failData,(e,n)=>n);const c=i({domain:n.createDomain("my-form"),validateOn:["submit"],filter:n.combine(l,s.pending,(e,n)=>!e&&!n),fields:{username:{init:"",rules:[a()]},password:{init:"",rules:[a()]}}});n.forward({from:c.formValidated,to:s}),e.createForm=i,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=effector-form.umd.js.map
