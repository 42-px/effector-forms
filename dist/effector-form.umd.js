!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("effector"),require("effector-react")):"function"==typeof define&&define.amd?define(["exports","effector","effector-react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).EffectorForm={},e.effector,e.effectorReact)}(this,(function(e,r,o){"use strict";function t(e,o,t){const n="function"==typeof o.init?o.init():o.init,s=t?t.store(n):r.createStore(n),i=t?t.store([]):r.createStore([]),u=i.map(e=>e[0]?e[0]:null);return{name:e,$value:s,$errors:i,$firstError:u,onChange:t?t.event():r.createEvent(),onBlur:t?t.event():r.createEvent()}}function n({$form:e,submitEvent:o,field:t,rules:n,formValidationEvents:s,fieldValidationEvents:i}){const{$value:u,$errors:a,onBlur:f,onChange:l}=t,c=function(e){return(r,o)=>{const t=[];for(const n of e){const e=n.validator(r,o);"boolean"!=typeof e||e||t.push({rule:n.name,value:r}),"object"!=typeof e||e.isValid||t.push({rule:n.name,errorText:e.errorText,value:r})}return t}}(n),d=[...s,...i],m=[];d.includes("submit")&&m.push(r.sample({source:r.combine({fieldValue:u,form:e}),clock:o})),d.includes("blur")&&m.push(r.sample({source:r.combine({fieldValue:u,form:e}),clock:f})),d.includes("change")&&m.push(r.sample({source:r.combine({fieldValue:u,form:e}),clock:l})),a.on(m,(e,{form:r,fieldValue:o})=>c(o,r)),d.includes("change")||a.reset(l)}function s({$value:e,onChange:r,name:o},t){e.on(r,(e,r)=>r).on(t,(e,r)=>r.hasOwnProperty(o)?r[o]:e)}function i(e){const r=o.useStore(e.$value),t=o.useStore(e.$errors),n=o.useStore(e.$firstError);return{name:e.name,value:r,errors:t,firstError:n,onChange:e.onChange,onBlur:e.onBlur,errorText:e=>n?e&&e[n.rule]?e[n.rule]:n.errorText||"":""}}e.createForm=function(e){const{filter:o,domain:i,fields:u,validateOn:a}=e,f={};for(const e in u){if(!u.hasOwnProperty(e))continue;const r=u[e];f[e]=t(e,r,i)}const l=function(e){const o={};for(const r in e)e.hasOwnProperty(r)&&(o[r]=e[r].$value);return r.combine(o)}(f),c=function(e){const o=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const{$firstError:t}=e[r];o.push(t)}return r.combine(o).map(e=>e.every(e=>null===e))}(f),d=o?r.combine(c,o,(e,r)=>e&&r):c,m=i?i.event():r.createEvent(),v=i?i.event():r.createEvent(),p=i?i.event():r.createEvent(),h=r.sample(l,m);for(const e in f){if(!f.hasOwnProperty(e))continue;const r=u[e],o=f[e];s(o,p),r.rules&&n({$form:l,rules:r.rules,submitEvent:m,field:o,formValidationEvents:a||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return r.guard({source:h,filter:d,target:v}),{fields:f,$values:l,$eachValid:c,submit:m,setForm:p,formValidated:v}},e.useField=i,e.useForm=function(e){const r={};for(const o in e.fields){if(!e.fields.hasOwnProperty(o))continue;const t=e.fields[o];r[o]=i(t)}const t=o.useStore(e.$values),n=o.useStore(e.$eachValid);return{fields:r,values:t,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!n,eachValid:n,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,errorText:(e,o)=>{const t=r[e];return t&&t.firstError?o&&o[t.firstError.rule]?o[t.firstError.rule]:t.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,formValidated:e.formValidated}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=effector-form.umd.js.map
