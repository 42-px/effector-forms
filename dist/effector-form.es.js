import{combine as r,createStore as e,createEvent as o,sample as t,guard as n}from"effector";import{useStore as s}from"effector-react";function i(r,t,n){const s="function"==typeof t.init?t.init():t.init,i=n?n.store(s):e(s),l=n?n.store([]):e([]),a=l.map(r=>r[0]?r[0]:null);return{name:r,$value:i,$errors:l,$firstError:a,onChange:n?n.event():o(),onBlur:n?n.event():o(),addError:n?n.event():o(),validate:n?n.event():o(),resetErrors:n?n.event():o()}}function l({$form:e,submitEvent:o,field:n,rules:s,formValidationEvents:i,fieldValidationEvents:l}){const{$value:a,$errors:u,onBlur:f,onChange:c,addError:d,validate:m,resetErrors:v}=n,E=function(r){return(e,o)=>{const t=[];for(const n of r){const r=n.validator(e,o);"boolean"!=typeof r||r||t.push({rule:n.name,value:e}),"object"!=typeof r||r.isValid||t.push({rule:n.name,errorText:r.errorText,value:e})}return t}}(s),h=[...i,...l],p=[];h.includes("submit")&&p.push(t({source:r({fieldValue:a,form:e}),clock:o})),h.includes("blur")&&p.push(t({source:r({fieldValue:a,form:e}),clock:f})),h.includes("change")&&p.push(t({source:r({fieldValue:a,form:e}),clock:c})),p.push(t({source:r({fieldValue:a,form:e}),clock:m}));const $=t({source:a,clock:d,fn:(r,{rule:e,errorText:o})=>({rule:e,value:r,errorText:o})});u.on(p,(r,{form:e,fieldValue:o})=>E(o,e)).on($,(r,e)=>[e,...r]).reset(v),h.includes("change")||u.reset(c)}function a({$value:r,onChange:e,name:o},t){r.on(e,(r,e)=>e).on(t,(r,e)=>e.hasOwnProperty(o)?e[o]:r)}function u(e){const{filter:s,domain:u,fields:f,validateOn:c}=e,d={};for(const r in f){if(!f.hasOwnProperty(r))continue;const e=f[r];d[r]=i(r,e,u)}const m=function(e){const o={};for(const r in e)e.hasOwnProperty(r)&&(o[r]=e[r].$value);return r(o)}(d),v=function(e){const o=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const{$firstError:t}=e[r];o.push(t)}return r(o).map(r=>r.every(r=>null===r))}(d),E=s?r(v,s,(r,e)=>r&&e):v,h=u?u.event():o(),p=u?u.event():o(),$=u?u.event():o(),V=t(m,h);for(const r in d){if(!d.hasOwnProperty(r))continue;const e=f[r],o=d[r];a(o,$),e.rules&&l({$form:m,rules:e.rules,submitEvent:h,field:o,formValidationEvents:c||["submit"],fieldValidationEvents:e.validateOn?e.validateOn:[]})}return n({source:V,filter:E,target:p}),{fields:d,$values:m,$eachValid:v,submit:h,setForm:$,formValidated:p}}function f(r){const e=s(r.$value),o=s(r.$errors),t=s(r.$firstError);return{name:r.name,value:e,errors:o,firstError:t,onChange:r.onChange,onBlur:r.onBlur,addError:r.addError,validate:r.validate,resetErrors:r.resetErrors,errorText:r=>t?r&&r[t.rule]?r[t.rule]:t.errorText||"":""}}function c(r){const e={};for(const o in r.fields){if(!r.fields.hasOwnProperty(o))continue;const t=r.fields[o];e[o]=f(t)}const o=s(r.$values),t=s(r.$eachValid);return{fields:e,values:o,hasError:r=>r?!!e[r]&&Boolean(e[r].firstError):!t,eachValid:t,errors:r=>e[r]?e[r].errors:[],error:r=>e[r]?e[r].firstError:null,errorText:(r,o)=>{const t=e[r];return t&&t.firstError?o&&o[t.firstError.rule]?o[t.firstError.rule]:t.firstError.errorText||"":""},submit:r.submit,setForm:r.setForm,formValidated:r.formValidated}}export{u as createForm,f as useField,c as useForm};
//# sourceMappingURL=effector-form.es.js.map
