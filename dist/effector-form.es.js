import{combine as e,createStore as n,createEvent as o,sample as t,guard as r,createEffect as i,createDomain as s,forward as l}from"effector";function a(e,t,r){const i="function"==typeof t.init?t.init():t.init,s=r?r.store(i):n(i),l=r?r.store([]):n([]),a=l.map(e=>e[0]?e[0]:null);return{name:e,$value:s,$errors:l,$firstError:a,onChange:r?r.event():o(),onBlur:r?r.event():o()}}function u({$form:n,submitEvent:o,field:r,rules:i,formValidationEvents:s,fieldValidationEvents:l}){const{$value:a,$errors:u,onBlur:f,onChange:c}=r,d=function(e){return(n,o)=>{const t=[];for(const r of e){const e=r.validator(n,o);"boolean"!=typeof e||e||t.push({rule:r.name,value:n}),"object"!=typeof e||e.isValid||t.push({rule:r.name,errorText:e.errorText,value:n})}return t}}(i),m=[...s,...l],v=[];m.includes("submit")&&v.push(t({source:e({fieldValue:a,form:n}),clock:o})),m.includes("blur")&&v.push(t({source:e({fieldValue:a,form:n}),clock:f})),m.includes("change")&&v.push(t({source:e({fieldValue:a,form:n}),clock:c})),u.on(v,(e,{form:n,fieldValue:o})=>d(o,n)),m.includes("change")||u.reset(c)}function f({$value:e,onChange:n,name:o},t){e.on(n,(e,n)=>n).on(t,(e,n)=>n.hasOwnProperty(o)?n[o]:e)}function c(n){const{filter:i,domain:s,fields:l,validateOn:c}=n,d={};for(const e in l){if(!l.hasOwnProperty(e))continue;const n=l[e];d[e]=a(e,n,s)}const m=function(n){const o={};for(const e in n)n.hasOwnProperty(e)&&(o[e]=n[e].$value);return e(o)}(d),v=function(n){const o=[];for(const e in n){if(!n.hasOwnProperty(e))continue;const{$firstError:t}=n[e];o.push(t)}return e(o).map(e=>e.every(e=>null===e))}(d),p=i?e(v,i,(e,n)=>e&&n):v,h=s?s.event():o(),V=s?s.event():o(),$=s?s.event():o(),y=t(m,h);for(const e in d){if(!d.hasOwnProperty(e))continue;const n=l[e],o=d[e];f(o,$),n.rules&&u({$form:m,rules:n.rules,submitEvent:h,field:o,formValidationEvents:c||["submit"],fieldValidationEvents:n.validateOn?n.validateOn:[]})}return r({source:y,filter:p,target:V}),{fields:d,$values:m,$eachValid:v,submit:h,setForm:$,formValidated:V}}const d=()=>({name:"required",validator:e=>Boolean(e)}),m=i(),v=n(null);v.on(m.failData,(e,n)=>n);l({from:c({domain:s("my-form"),validateOn:["submit"],filter:e(v,m.pending,(e,n)=>!e&&!n),fields:{username:{init:"",rules:[d()]},password:{init:"",rules:[d()]}}}).formValidated,to:m});export{c as createForm};
//# sourceMappingURL=effector-form.es.js.map
