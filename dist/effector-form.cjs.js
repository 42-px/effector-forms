"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("effector");function n(n,t,r){const o="function"==typeof t.init?t.init():t.init,i=r?r.store(o):e.createStore(o),a=r?r.store([]):e.createStore([]),s=a.map(e=>e[0]?e[0]:null);return{name:n,$value:i,$errors:a,$firstError:s,onChange:r?r.event():e.createEvent(),onBlur:r?r.event():e.createEvent()}}function t({$form:n,submitEvent:t,field:r,rules:o,formValidationEvents:i,fieldValidationEvents:a}){const{$value:s,$errors:l,onBlur:c,onChange:u}=r,f=function(e){return(n,t)=>{const r=[];for(const o of e){const e=o.validator(n,t);"boolean"!=typeof e||e||r.push({rule:o.name,value:n}),"object"!=typeof e||e.isValid||r.push({rule:o.name,errorText:e.errorText,value:n})}return r}}(o),m=[...i,...a],d=[];m.includes("submit")&&d.push(e.sample({source:e.combine({fieldValue:s,form:n}),clock:t})),m.includes("blur")&&d.push(e.sample({source:e.combine({fieldValue:s,form:n}),clock:c})),m.includes("change")&&d.push(e.sample({source:e.combine({fieldValue:s,form:n}),clock:u})),l.on(d,(e,{form:n,fieldValue:t})=>f(t,n)),m.includes("change")||l.reset(u)}function r({$value:e,onChange:n,name:t},r){e.on(n,(e,n)=>n).on(r,(e,n)=>n.hasOwnProperty(t)?n[t]:e)}function o(o){const{filter:i,domain:a,fields:s,validateOn:l}=o,c={};for(const e in s){if(!s.hasOwnProperty(e))continue;const t=s[e];c[e]=n(e,t,a)}const u=function(n){const t={};for(const e in n)n.hasOwnProperty(e)&&(t[e]=n[e].$value);return e.combine(t)}(c),f=function(n){const t=[];for(const e in n){if(!n.hasOwnProperty(e))continue;const{$firstError:r}=n[e];t.push(r)}return e.combine(t).map(e=>e.every(e=>null===e))}(c),m=i?e.combine(f,i,(e,n)=>e&&n):f,d=a?a.event():e.createEvent(),v=a?a.event():e.createEvent(),p=a?a.event():e.createEvent(),b=e.sample(u,d);for(const e in c){if(!c.hasOwnProperty(e))continue;const n=s[e],o=c[e];r(o,p),n.rules&&t({$form:u,rules:n.rules,submitEvent:d,field:o,formValidationEvents:l||["submit"],fieldValidationEvents:n.validateOn?n.validateOn:[]})}return e.guard({source:b,filter:m,target:v}),{fields:c,$values:u,$eachValid:f,submit:d,setForm:p,formValidated:v}}const i=()=>({name:"required",validator:e=>Boolean(e)}),a=e.createEffect(),s=e.createStore(null);s.on(a.failData,(e,n)=>n);const l=o({domain:e.createDomain("my-form"),validateOn:["submit"],filter:e.combine(s,a.pending,(e,n)=>!e&&!n),fields:{username:{init:"",rules:[i()]},password:{init:"",rules:[i()]}}});e.forward({from:l.formValidated,to:a}),exports.createForm=o;
//# sourceMappingURL=effector-form.cjs.js.map
