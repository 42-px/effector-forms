"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("effector"),r=require("effector-react");function o(r,o,t){const n="function"==typeof o.init?o.init():o.init,s=t?t.store(n):e.createStore(n),i=t?t.store([]):e.createStore([]),u=i.map(e=>e[0]?e[0]:null);return{name:r,$value:s,$errors:i,$firstError:u,onChange:t?t.event():e.createEvent(),onBlur:t?t.event():e.createEvent()}}function t({$form:r,submitEvent:o,field:t,rules:n,formValidationEvents:s,fieldValidationEvents:i}){const{$value:u,$errors:a,onBlur:l,onChange:c}=t,f=function(e){return(r,o)=>{const t=[];for(const n of e){const e=n.validator(r,o);"boolean"!=typeof e||e||t.push({rule:n.name,value:r}),"object"!=typeof e||e.isValid||t.push({rule:n.name,errorText:e.errorText,value:r})}return t}}(n),m=[...s,...i],d=[];m.includes("submit")&&d.push(e.sample({source:e.combine({fieldValue:u,form:r}),clock:o})),m.includes("blur")&&d.push(e.sample({source:e.combine({fieldValue:u,form:r}),clock:l})),m.includes("change")&&d.push(e.sample({source:e.combine({fieldValue:u,form:r}),clock:c})),a.on(d,(e,{form:r,fieldValue:o})=>f(o,r)),m.includes("change")||a.reset(c)}function n({$value:e,onChange:r,name:o},t){e.on(r,(e,r)=>r).on(t,(e,r)=>r.hasOwnProperty(o)?r[o]:e)}function s(e){const o=r.useStore(e.$value),t=r.useStore(e.$errors),n=r.useStore(e.$firstError);return{name:e.name,value:o,errors:t,firstError:n,onChange:e.onChange,onBlur:e.onBlur,errorText:e=>n?e&&e[n.rule]?e[n.rule]:n.errorText||"":""}}exports.createForm=function(r){const{filter:s,domain:i,fields:u,validateOn:a}=r,l={};for(const e in u){if(!u.hasOwnProperty(e))continue;const r=u[e];l[e]=o(e,r,i)}const c=function(r){const o={};for(const e in r)r.hasOwnProperty(e)&&(o[e]=r[e].$value);return e.combine(o)}(l),f=function(r){const o=[];for(const e in r){if(!r.hasOwnProperty(e))continue;const{$firstError:t}=r[e];o.push(t)}return e.combine(o).map(e=>e.every(e=>null===e))}(l),m=s?e.combine(f,s,(e,r)=>e&&r):f,d=i?i.event():e.createEvent(),v=i?i.event():e.createEvent(),p=i?i.event():e.createEvent(),h=e.sample(c,d);for(const e in l){if(!l.hasOwnProperty(e))continue;const r=u[e],o=l[e];n(o,p),r.rules&&t({$form:c,rules:r.rules,submitEvent:d,field:o,formValidationEvents:a||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return e.guard({source:h,filter:m,target:v}),{fields:l,$values:c,$eachValid:f,submit:d,setForm:p,formValidated:v}},exports.useField=s,exports.useForm=function(e){const o={};for(const r in e.fields){if(!e.fields.hasOwnProperty(r))continue;const t=e.fields[r];o[r]=s(t)}const t=r.useStore(e.$values),n=r.useStore(e.$eachValid);return{fields:o,values:t,hasError:e=>e?!!o[e]&&Boolean(o[e].firstError):!n,eachValid:n,errors:e=>o[e]?o[e].errors:[],error:e=>o[e]?o[e].firstError:null,errorText:(e,r)=>{const t=o[e];return t&&t.firstError?r&&r[t.firstError.rule]?r[t.firstError.rule]:t.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,formValidated:e.formValidated}};
//# sourceMappingURL=effector-form.cjs.js.map
