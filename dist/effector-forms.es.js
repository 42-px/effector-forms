import{combine as r,createStore as e,createEvent as o,sample as t,guard as n}from"effector";import{useStore as s}from"effector-react";function i(r,t,n){const s="function"==typeof t.init?t.init():t.init,i=n?n.store(s):e(s),l=n?n.store([]):e([]),a=l.map(r=>r[0]?r[0]:null),u=n?n.event():o(),f=n?n.event():o(),c=n?n.event():o(),d=n?n.event():o(),m=n?n.event():o(),v=n?n.event():o();return{name:r,$value:i,$errors:l,$firstError:a,$isValid:a.map(r=>null===r),onChange:u,onBlur:f,addError:c,validate:d,set:u,reset:v,resetErrors:m}}function l({$form:e,submitEvent:o,field:n,rules:s,formValidationEvents:i,fieldValidationEvents:l}){const{$value:a,$errors:u,onBlur:f,onChange:c,addError:d,validate:m,resetErrors:v}=n,h=function(r){return(e,o)=>{const t=[];for(const n of r){const r=n.validator(e,o);"boolean"!=typeof r||r||t.push({rule:n.name,value:e}),"object"!=typeof r||r.isValid||t.push({rule:n.name,errorText:r.errorText,value:e})}return t}}(s),E=[...i,...l],p=[];E.includes("submit")&&p.push(t({source:r({fieldValue:a,form:e}),clock:o})),E.includes("blur")&&p.push(t({source:r({fieldValue:a,form:e}),clock:f})),E.includes("change")&&p.push(t({source:r({fieldValue:a,form:e}),clock:c})),p.push(t({source:r({fieldValue:a,form:e}),clock:m}));const V=t({source:a,clock:d,fn:(r,{rule:e,errorText:o})=>({rule:e,value:r,errorText:o})});u.on(p,(r,{form:e,fieldValue:o})=>h(o,e)).on(V,(r,e)=>[e,...r]).reset(v),E.includes("change")||u.reset(c)}function a({$value:r,onChange:e,name:o,reset:t},n,s){r.on(e,(r,e)=>e).on(n,(r,e)=>e.hasOwnProperty(o)?e[o]:r).reset(t,s)}function u(e){const{filter:s,domain:u,fields:f,validateOn:c}=e,d={};for(const r in f){if(!f.hasOwnProperty(r))continue;const e=f[r];d[r]=i(r,e,u)}const m=function(e){const o={};for(const r in e)e.hasOwnProperty(r)&&(o[r]=e[r].$value);return r(o)}(d),v=function(e){const o=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const{$firstError:t}=e[r];o.push(t)}return r(o).map(r=>r.every(r=>null===r))}(d),h=s?r(v,s,(r,e)=>r&&e):v,E=u?u.event():o(),p=u?u.event():o(),V=u?u.event():o(),$=u?u.event():o(),b=t(m,E);for(const r in d){if(!d.hasOwnProperty(r))continue;const e=f[r],o=d[r];a(o,V,$),e.rules&&l({$form:m,rules:e.rules,submitEvent:E,field:o,formValidationEvents:c||["submit"],fieldValidationEvents:e.validateOn?e.validateOn:[]})}return n({source:b,filter:h,target:p}),{fields:d,$values:m,$eachValid:v,$isValid:v,submit:E,reset:$,setForm:V,set:V,formValidated:p}}function f(r){const e=s(r.$value),o=s(r.$errors),t=s(r.$firstError),n=s(r.$isValid);return{name:r.name,value:e,errors:o,firstError:t,isValid:n,onChange:r.onChange,onBlur:r.onBlur,addError:r.addError,validate:r.validate,reset:r.reset,set:r.onChange,resetErrors:r.resetErrors,hasError:()=>null!==t,errorText:r=>t?r&&r[t.rule]?r[t.rule]:t.errorText||"":""}}function c(r){const e={};for(const o in r.fields){if(!r.fields.hasOwnProperty(o))continue;const t=r.fields[o];e[o]=f(t)}const o=s(r.$values),t=s(r.$eachValid);return{fields:e,values:o,hasError:r=>r?!!e[r]&&Boolean(e[r].firstError):!t,eachValid:t,isValid:t,errors:r=>e[r]?e[r].errors:[],error:r=>e[r]?e[r].firstError:null,reset:r.reset,errorText:(r,o)=>{const t=e[r];return t&&t.firstError?o&&o[t.firstError.rule]?o[t.firstError.rule]:t.firstError.errorText||"":""},submit:r.submit,setForm:r.setForm,set:r.setForm,formValidated:r.formValidated}}export{u as createForm,f as useField,c as useForm};
//# sourceMappingURL=effector-forms.es.js.map
