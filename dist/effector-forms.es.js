import{combine as r,createStore as e,createEvent as t,sample as o,guard as n}from"effector";import{useStore as s}from"effector-react";function i(r,o,n){const s="function"==typeof o.init?o.init():o.init,i=n?n.store(s):e(s),l=n?n.store([]):e([]),a=l.map(r=>r[0]?r[0]:null),u=i.map(r=>r!==s),c=n?n.store(!1):e(!1),f=n?n.event():t(),d=n?n.event():t(),m=n?n.event():t(),h=n?n.event():t(),v=n?n.event():t(),$=n?n.event():t(),p=n?n.event():t();return{changed:m,name:r,$value:i,$errors:l,$firstError:a,$isValid:a.map(r=>null===r),$isDirty:u,$touched:c,onChange:f,onBlur:d,addError:h,validate:v,set:f,reset:p,resetErrors:$,filter:o.filter}}function l({$form:e,submitEvent:t,field:n,rules:s,formValidationEvents:i,fieldValidationEvents:l}){const{$value:a,$errors:u,onBlur:c,changed:f,addError:d,validate:m,resetErrors:h}=n,v=function(r){return(e,t)=>{const o=[];for(const n of r){const r=n.validator(e,t);"boolean"!=typeof r||r||o.push({rule:n.name,value:e}),"object"!=typeof r||r.isValid||o.push({rule:n.name,errorText:r.errorText,value:e})}return o}}(s),$=[...i,...l],p=[];$.includes("submit")&&p.push(o({source:r({fieldValue:a,form:e}),clock:t})),$.includes("blur")&&p.push(o({source:r({fieldValue:a,form:e}),clock:c})),$.includes("change")&&p.push(o({source:r({fieldValue:a,form:e}),clock:f})),p.push(o({source:r({fieldValue:a,form:e}),clock:m}));const E=o({source:a,clock:d,fn:(r,{rule:e,errorText:t})=>({rule:e,value:r,errorText:t})});u.on(p,(r,{form:e,fieldValue:t})=>v(t,e)).on(E,(r,e)=>[e,...r]).reset(h),$.includes("change")||u.reset(f)}function a({$value:r,$touched:e,onChange:t,changed:o,name:s,reset:i,filter:l},a,u){e.on(o,()=>!0).reset(i,u),n({source:t,filter:l||(()=>!0),target:o}),r.on(o,(r,e)=>e).on(a,(r,e)=>e.hasOwnProperty(s)?e[s]:r).reset(i,u)}function u(e){const{filter:s,domain:u,fields:c,validateOn:f}=e,d={},m=[],h=[];for(const r in c){if(!c.hasOwnProperty(r))continue;const e=i(r,c[r],u);d[r]=e,m.push(e.$isDirty),h.push(e.$touched)}const v=function(e){const t={};for(const r in e)e.hasOwnProperty(r)&&(t[r]=e[r].$value);return r(t)}(d),$=function(e){const t=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const{$firstError:o}=e[r];t.push(o)}return r(t).map(r=>r.every(r=>null===r))}(d),p=s?r($,s,(r,e)=>r&&e):$,E=r(m).map(r=>r.some(Boolean)),V=r(h).map(r=>r.some(Boolean)),y=u?u.event():t(),g=u?u.event():t(),b=u?u.event():t(),x=u?u.event():t(),O=o(v,y);for(const r in d){if(!d.hasOwnProperty(r))continue;const e=c[r],t=d[r];a(t,b,x),e.rules&&l({$form:v,rules:e.rules,submitEvent:y,field:t,formValidationEvents:f||["submit"],fieldValidationEvents:e.validateOn?e.validateOn:[]})}return n({source:O,filter:p,target:g}),{fields:d,$values:v,$eachValid:$,$isValid:$,$isDirty:E,$touched:V,submit:y,reset:x,setForm:b,set:b,formValidated:g}}function c(r){const e=s(r.$value),t=s(r.$errors),o=s(r.$firstError),n=s(r.$isValid),i=s(r.$isDirty),l=s(r.$touched);return{name:r.name,value:e,errors:t,firstError:o,isValid:n,isDirty:i,touched:l,onChange:r.onChange,onBlur:r.onBlur,addError:r.addError,validate:r.validate,reset:r.reset,set:r.onChange,resetErrors:r.resetErrors,hasError:()=>null!==o,errorText:r=>o?r&&r[o.rule]?r[o.rule]:o.errorText||"":""}}function f(r){const e={};for(const t in r.fields){if(!r.fields.hasOwnProperty(t))continue;const o=r.fields[t];e[t]=c(o)}const t=s(r.$values),o=s(r.$eachValid),n=s(r.$isDirty),i=s(r.$touched);return{fields:e,values:t,hasError:r=>r?!!e[r]&&Boolean(e[r].firstError):!o,eachValid:o,isValid:o,isDirty:n,touched:i,errors:r=>e[r]?e[r].errors:[],error:r=>e[r]?e[r].firstError:null,reset:r.reset,errorText:(r,t)=>{const o=e[r];return o&&o.firstError?t&&t[o.firstError.rule]?t[o.firstError.rule]:o.firstError.errorText||"":""},submit:r.submit,setForm:r.setForm,set:r.setForm,formValidated:r.formValidated}}export{u as createForm,c as useField,f as useForm};
//# sourceMappingURL=effector-forms.es.js.map
