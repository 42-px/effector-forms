import{combine as e,createStore as r,createEvent as t,sample as o,guard as i}from"effector";import{useStore as n}from"effector-react";const s={store:function({init:e,domain:t,existing:o}){return o||(t?t.store(e):r(e))},event:function({domain:e,existing:r}){return r||(e?e.event():t())}};function l(e,r,t){var o,i,n,l,u,a,d,c,v,f,m;const h="function"==typeof r.init?r.init():r.init,g=s.store({domain:t,existing:null===(o=r.units)||void 0===o?void 0:o.$value,init:h}),$=s.store({domain:t,existing:null===(i=r.units)||void 0===i?void 0:i.$errors,init:[]}),E=$.map(e=>e[0]?e[0]:null),x=g.map(e=>e!==h),V=s.store({domain:t,existing:null===(n=r.units)||void 0===n?void 0:n.$isTouched,init:!1}),p=s.event({domain:t,existing:null===(l=r.units)||void 0===l?void 0:l.onChange}),y=s.event({domain:t,existing:null===(u=r.units)||void 0===u?void 0:u.onBlur}),T=s.event({domain:t,existing:null===(a=r.units)||void 0===a?void 0:a.changed}),b=s.event({domain:t,existing:null===(d=r.units)||void 0===d?void 0:d.addError}),F=s.event({domain:t,existing:null===(c=r.units)||void 0===c?void 0:c.validate}),O=s.event({domain:t,existing:null===(v=r.units)||void 0===v?void 0:v.resetErrors}),B=s.event({domain:t,existing:null===(f=r.units)||void 0===f?void 0:f.resetValue}),D=s.event({domain:t,existing:null===(m=r.units)||void 0===m?void 0:m.reset});return{changed:T,name:e,$value:g,$errors:$,$firstError:E,$isValid:E.map(e=>null===e),$isDirty:x,$isTouched:V,$touched:V,onChange:p,onBlur:y,addError:b,validate:F,set:p,reset:D,resetErrors:O,resetValue:B,filter:r.filter}}function u({$form:t,validateFormEvent:i,submitEvent:n,resetFormEvent:s,resetValues:l,field:u,rules:a,formValidationEvents:d,fieldValidationEvents:c}){const{$value:v,$errors:f,onBlur:m,changed:h,addError:g,validate:$,resetErrors:E,resetValue:x,reset:V}=u,p=e(a.map(({source:e})=>e||r(null))),y=function(e){return(r,t,o)=>{const i=[];for(let n=0;n<e.length;n++){const s=e[n],l=o?o[n]:null,u=s.validator(r,t,l);"boolean"!=typeof u||u||i.push({rule:s.name,errorText:s.errorText,value:r}),"object"!=typeof u||u.isValid||i.push({rule:s.name,errorText:u.errorText,value:r})}return i}}(a),T=[...d,...c],b=[];T.includes("submit")&&b.push(o({source:e({fieldValue:v,form:t,rulesSources:p}),clock:n})),T.includes("blur")&&b.push(o({source:e({fieldValue:v,form:t,rulesSources:p}),clock:m})),T.includes("change")&&b.push(o({source:e({fieldValue:v,form:t,rulesSources:p}),clock:[h,x,l]})),b.push(o({source:e({fieldValue:v,form:t,rulesSources:p}),clock:$})),b.push(o({source:e({fieldValue:v,form:t,rulesSources:p}),clock:i}));const F=o({source:v,clock:g,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})});f.on(b,(e,{form:r,fieldValue:t,rulesSources:o})=>y(t,r,o)).on(F,(e,r)=>[r,...e]).reset(E,s,V),T.includes("change")||f.reset(h)}function a({$value:e,$touched:r,onChange:t,changed:o,name:n,reset:s,resetValue:l,filter:u},a,d,c,v){r.on(o,()=>!0).reset(s,d,c),i({source:t,filter:u||(()=>!0),target:o}),e.on(o,(e,r)=>r).on(a,(e,r)=>r.hasOwnProperty(n)?r[n]:e).reset(s,l,v,d)}function d(r){const{filter:t,domain:n,fields:d,validateOn:c,units:v}=r,f={},m=[],h=[];for(const e in d){if(!d.hasOwnProperty(e))continue;const r=l(e,d[e],n);f[e]=r,m.push(r.$isDirty),h.push(r.$touched)}const g=function(r){const t={};for(const e in r)r.hasOwnProperty(e)&&(t[e]=r[e].$value);return e(t)}(f),$=function(r){const t=[];for(const e in r){if(!r.hasOwnProperty(e))continue;const{$firstError:o}=r[e];t.push(o)}return e(t).map(e=>e.every(e=>null===e))}(f),E=t?e($,t,(e,r)=>e&&r):$,x=e(m).map(e=>e.some(Boolean)),V=e(h).map(e=>e.some(Boolean)),p=s.event({domain:n,existing:null==v?void 0:v.validate}),y=s.event({domain:n,existing:null==v?void 0:v.submit}),T=s.event({domain:n,existing:null==v?void 0:v.formValidated}),b=s.event({domain:n,existing:null==v?void 0:v.setForm}),F=s.event({domain:n,existing:null==v?void 0:v.reset}),O=s.event({domain:n,existing:null==v?void 0:v.resetValues}),B=s.event({domain:n,existing:null==v?void 0:v.resetTouched}),D=o(g,y),k=o(g,p);for(const e in f){if(!f.hasOwnProperty(e))continue;const r=d[e],t=f[e];a(t,b,F,B,O),r.rules&&u({$form:g,rules:r.rules,submitEvent:y,resetFormEvent:F,resetValues:O,validateFormEvent:p,field:t,formValidationEvents:c||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return i({source:D,filter:E,target:T}),i({source:k,filter:E,target:T}),{fields:f,$values:g,$eachValid:$,$isValid:$,$isDirty:x,$touched:V,submit:y,validate:p,resetTouched:B,reset:F,resetValues:O,setForm:b,set:b,formValidated:T}}function c(e){const r=n(e.$value),t=n(e.$errors),o=n(e.$firstError),i=n(e.$isValid),s=n(e.$isDirty),l=n(e.$touched);return{name:e.name,value:r,errors:t,firstError:o,isValid:i,isDirty:s,touched:l,isTouched:l,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==o,errorText:e=>o?e&&e[o.rule]?e[o.rule]:o.errorText||"":""}}function v(e){const r={};for(const t in e.fields){if(!e.fields.hasOwnProperty(t))continue;const o=e.fields[t];r[t]=c(o)}const t=n(e.$values),o=n(e.$eachValid),i=n(e.$isDirty),s=n(e.$touched);return{fields:r,values:t,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!o,eachValid:o,isValid:o,isDirty:i,isTouched:s,touched:s,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,reset:e.reset,errorText:(e,t)=>{const o=r[e];return o&&o.firstError?t&&t[o.firstError.rule]?t[o.firstError.rule]:o.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}}export{d as createForm,c as useField,v as useForm};
//# sourceMappingURL=index.js.map
