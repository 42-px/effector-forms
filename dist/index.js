import{combine as e,createStore as r,createEvent as t,sample as i,merge as o,guard as n}from"effector";import{useStore as s}from"effector-react";const l={store:function({init:e,domain:t,existing:i}){return i||(t?t.store(e):r(e))},event:function({domain:e,existing:r}){return r||(e?e.event():t())}};function u(r,t,i){var o,n,s,u,a,d,c,v,f,m,h;const g="function"==typeof t.init?t.init():t.init,E=l.store({domain:i,existing:null===(o=t.units)||void 0===o?void 0:o.$value,init:g}),V=l.store({domain:i,existing:null===(n=t.units)||void 0===n?void 0:n.$errors,init:[]}),x=V.map(e=>e[0]?e[0]:null),p=E.map(e=>e!==g),$=l.store({domain:i,existing:null===(s=t.units)||void 0===s?void 0:s.$isTouched,init:!1}),y=l.event({domain:i,existing:null===(u=t.units)||void 0===u?void 0:u.onChange}),T=l.event({domain:i,existing:null===(a=t.units)||void 0===a?void 0:a.onBlur}),b=l.event({domain:i,existing:null===(d=t.units)||void 0===d?void 0:d.changed}),D=l.event({domain:i,existing:null===(c=t.units)||void 0===c?void 0:c.addError}),F=l.event({domain:i,existing:null===(v=t.units)||void 0===v?void 0:v.validate}),O=l.event({domain:i,existing:null===(f=t.units)||void 0===f?void 0:f.resetErrors}),B=l.event({domain:i,existing:null===(m=t.units)||void 0===m?void 0:m.resetValue}),k=l.event({domain:i,existing:null===(h=t.units)||void 0===h?void 0:h.reset}),w=x.map(e=>null===e);return{changed:b,name:r,$value:E,$errors:V,$firstError:x,$isValid:w,$isDirty:p,$isTouched:$,$touched:$,$field:e({value:E,errors:V,firstError:x,isValid:w,isDirty:p,isTouched:$}),onChange:y,onBlur:T,addError:D,validate:F,set:y,reset:k,resetErrors:O,resetValue:B,filter:t.filter}}function a({$form:t,validateFormEvent:n,submitEvent:s,resetFormEvent:l,resetValues:u,field:a,rules:d,resetErrors:c,formValidationEvents:v,fieldValidationEvents:f}){const{$value:m,$errors:h,onBlur:g,changed:E,addError:V,validate:x,resetErrors:p,resetValue:$,reset:y}=a,T="function"==typeof d?r([]):e(d.map(({source:e})=>e||r(null))),b=(D=d,(e,r,t)=>{const i=[],o="function"==typeof D?D(e,r):D;for(let n=0;n<o.length;n++){const s=o[n],l=t?t[n]:null,u=s.validator(e,r,l);"boolean"!=typeof u||u||i.push({rule:s.name,errorText:s.errorText,value:e}),"object"!=typeof u||u.isValid||i.push({rule:s.name,errorText:u.errorText,value:e})}return i});var D;const F=[...v,...f],O=[];if(F.includes("submit")){const r=i({source:e({fieldValue:m,form:t,rulesSources:T}),clock:s});O.push(r)}F.includes("blur")&&O.push(i({source:e({fieldValue:m,form:t,rulesSources:T}),clock:g})),F.includes("change")&&O.push(i({source:e({fieldValue:m,form:t,rulesSources:T}),clock:o([E,$,u])})),O.push(i({source:e({fieldValue:m,form:t,rulesSources:T}),clock:x})),O.push(i({source:e({fieldValue:m,form:t,rulesSources:T}),clock:n}));const B=i({source:m,clock:V,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})});h.on(O,(e,{form:r,fieldValue:t,rulesSources:i})=>b(t,r,i)).on(B,(e,r)=>[r,...e]).reset(p,l,y,c),F.includes("change")||h.reset(E)}function d({$value:e,$touched:r,onChange:t,changed:i,name:o,reset:s,resetValue:l,filter:u},a,d,c,v){r.on(i,()=>!0).reset(s,d,c),n({source:t,filter:u||(()=>!0),target:i}),e.on(i,(e,r)=>r).on(a,(e,r)=>r.hasOwnProperty(o)?r[o]:e).reset(s,l,v,d)}function c(r){const{filter:t,domain:o,fields:s,validateOn:c,units:v}=r,f={},m=[],h=[];for(const e in s){if(!s.hasOwnProperty(e))continue;const r=u(e,s[e],o);f[e]=r,m.push(r.$isDirty),h.push(r.$touched)}const g=function(r){const t={};for(const e in r)r.hasOwnProperty(e)&&(t[e]=r[e].$value);return e(t)}(f),E=function(r){const t=[];for(const e in r){if(!r.hasOwnProperty(e))continue;const{$firstError:i}=r[e];t.push(i)}return e(t).map(e=>e.every(e=>null===e))}(f),V=t?e(E,t,(e,r)=>e&&r):E,x=e(m).map(e=>e.some(Boolean)),p=e(h).map(e=>e.some(Boolean)),$=e({isValid:E,isDirty:x,touched:p}),y=l.event({domain:o,existing:null==v?void 0:v.validate}),T=l.event({domain:o,existing:null==v?void 0:v.submit}),b=l.event({domain:o,existing:null==v?void 0:v.formValidated}),D=l.event({domain:o,existing:null==v?void 0:v.setForm}),F=l.event({domain:o,existing:null==v?void 0:v.reset}),O=l.event({domain:o,existing:null==v?void 0:v.resetValues}),B=l.event({domain:o,existing:null==v?void 0:v.resetErrors}),k=l.event({domain:o,existing:null==v?void 0:v.resetTouched}),w=i(g,T),C=i(g,y);for(const e in f){if(!f.hasOwnProperty(e))continue;const r=s[e],t=f[e];d(t,D,F,k,O),r.rules&&a({$form:g,rules:r.rules,submitEvent:T,resetFormEvent:F,resetValues:O,resetErrors:B,validateFormEvent:y,field:t,formValidationEvents:c||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return n({source:w,filter:V,target:b}),n({source:C,filter:V,target:b}),{fields:f,$values:g,$eachValid:E,$isValid:E,$isDirty:x,$touched:p,$meta:$,submit:T,validate:y,resetTouched:k,reset:F,resetValues:O,resetErrors:B,setForm:D,set:D,formValidated:b}}function v(e){const{value:r,errors:t,firstError:i,isValid:o,isDirty:n,isTouched:l}=s(e.$field);return{name:e.name,value:r,errors:t,firstError:i,isValid:o,isDirty:n,touched:l,isTouched:l,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==i,errorText:e=>i?e&&e[i.rule]?e[i.rule]:i.errorText||"":""}}function f(e){const r={},t={};for(const i in e.fields){if(!e.fields.hasOwnProperty(i))continue;const o=v(e.fields[i]);r[i]=o,t[i]=o.value}const{isValid:i,isDirty:o,touched:n}=s(e.$meta);return{fields:r,values:t,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!i,eachValid:i,isValid:i,isDirty:o,isTouched:n,touched:n,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,reset:e.reset,errorText:(e,t)=>{const i=r[e];return i&&i.firstError?t&&t[i.firstError.rule]?t[i.firstError.rule]:i.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}}export{c as createForm,v as useField,f as useForm};
//# sourceMappingURL=index.js.map
