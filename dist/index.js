import{combine as r,createStore as e,createEvent as t,sample as n,merge as o,guard as i}from"effector";import{useStore as u}from"effector-react";function s(r){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}function a(r){return function(r){if(Array.isArray(r))return l(r)}(r)||function(r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(r))return Array.from(r)}(r)||function(r,e){if(!r)return;if("string"==typeof r)return l(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);"Object"===t&&r.constructor&&(t=r.constructor.name);if("Map"===t||"Set"===t)return Array.from(r);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return l(r,e)}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var d={store:function(r){var t=r.init,n=r.domain,o=r.existing;return o||(n?n.store(t):e(t))},event:function(r){var e=r.domain,n=r.existing;return n||(e?e.event():t())}};function f(r,e,t){var n,o,i,u,s,a,l,f,c,v,m,h="function"==typeof e.init?e.init():e.init,p=d.store({domain:t,existing:null===(n=e.units)||void 0===n?void 0:n.$value,init:h}),y=d.store({domain:t,existing:null===(o=e.units)||void 0===o?void 0:o.$errors,init:[]}),g=y.map((function(r){return r[0]?r[0]:null})),E=p.map((function(r){return r!==h})),$=d.store({domain:t,existing:null===(i=e.units)||void 0===i?void 0:i.$isTouched,init:!1}),x=d.event({domain:t,existing:null===(u=e.units)||void 0===u?void 0:u.onChange}),V=d.event({domain:t,existing:null===(s=e.units)||void 0===s?void 0:s.onBlur}),b=d.event({domain:t,existing:null===(a=e.units)||void 0===a?void 0:a.changed}),T=d.event({domain:t,existing:null===(l=e.units)||void 0===l?void 0:l.addError}),S=d.event({domain:t,existing:null===(f=e.units)||void 0===f?void 0:f.validate}),O=d.event({domain:t,existing:null===(c=e.units)||void 0===c?void 0:c.resetErrors}),w=d.event({domain:t,existing:null===(v=e.units)||void 0===v?void 0:v.resetValue}),F=d.event({domain:t,existing:null===(m=e.units)||void 0===m?void 0:m.reset});return{changed:b,name:r,$value:p,$errors:y,$firstError:g,$isValid:g.map((function(r){return null===r})),$isDirty:E,$isTouched:$,$touched:$,onChange:x,onBlur:V,addError:T,validate:S,set:x,reset:F,resetErrors:O,resetValue:w,filter:e.filter}}function c(t){var i,u=t.$form,l=t.validateFormEvent,d=t.submitEvent,f=t.resetFormEvent,c=t.resetValues,v=t.field,m=t.rules,h=t.resetErrors,p=t.formValidationEvents,y=t.fieldValidationEvents,g=v.$value,E=v.$errors,$=v.onBlur,x=v.changed,V=v.addError,b=v.validate,T=v.resetErrors,S=v.resetValue,O=v.reset,w="function"==typeof m?e([]):r(m.map((function(r){return r.source||e(null)}))),F=(i=m,function(r,e,t){for(var n=[],o="function"==typeof i?i(r,e):i,u=0;u<o.length;u++){var a=o[u],l=t?t[u]:null,d=a.validator(r,e,l);"boolean"!=typeof d||d||n.push({rule:a.name,errorText:a.errorText,value:r}),"object"!==s(d)||d.isValid||n.push({rule:a.name,errorText:d.errorText,value:r})}return n}),B=[].concat(a(p),a(y)),A=[];B.includes("submit")&&A.push(n({source:r({fieldValue:g,form:u,rulesSources:w}),clock:d})),B.includes("blur")&&A.push(n({source:r({fieldValue:g,form:u,rulesSources:w}),clock:$})),B.includes("change")&&A.push(n({source:r({fieldValue:g,form:u,rulesSources:w}),clock:o([x,S,c])})),A.push(n({source:r({fieldValue:g,form:u,rulesSources:w}),clock:b})),A.push(n({source:r({fieldValue:g,form:u,rulesSources:w}),clock:l}));var C=n({source:g,clock:V,fn:function(r,e){return{rule:e.rule,value:r,errorText:e.errorText}}});E.on(A,(function(r,e){var t=e.form,n=e.fieldValue,o=e.rulesSources;return F(n,t,o)})).on(C,(function(r,e){return[e].concat(a(r))})).reset(T,f,O,h),B.includes("change")||E.reset(x)}function v(r,e,t,n,o){var u=r.$value,s=r.$touched,a=r.onChange,l=r.changed,d=r.name,f=r.reset,c=r.resetValue,v=r.filter;s.on(l,(function(){return!0})).reset(f,t,n),i({source:a,filter:v||function(){return!0},target:l}),u.on(l,(function(r,e){return e})).on(e,(function(r,e){return e.hasOwnProperty(d)?e[d]:r})).reset(f,c,o,t)}function m(e){var t=e.filter,o=e.domain,u=e.fields,s=e.validateOn,a=e.units,l={},m=[],h=[];for(var p in u)if(u.hasOwnProperty(p)){var y=f(p,u[p],o);l[p]=y,m.push(y.$isDirty),h.push(y.$touched)}var g=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n].$value);return r(t)}(l),E=function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var o=e[n].$firstError;t.push(o)}return r(t).map((function(r){return r.every((function(r){return null===r}))}))}(l),$=t?r(E,t,(function(r,e){return r&&e})):E,x=r(m).map((function(r){return r.some(Boolean)})),V=r(h).map((function(r){return r.some(Boolean)})),b=d.event({domain:o,existing:null==a?void 0:a.validate}),T=d.event({domain:o,existing:null==a?void 0:a.submit}),S=d.event({domain:o,existing:null==a?void 0:a.formValidated}),O=d.event({domain:o,existing:null==a?void 0:a.setForm}),w=d.event({domain:o,existing:null==a?void 0:a.reset}),F=d.event({domain:o,existing:null==a?void 0:a.resetValues}),B=d.event({domain:o,existing:null==a?void 0:a.resetErrors}),A=d.event({domain:o,existing:null==a?void 0:a.resetTouched}),C=n(g,T),D=n(g,b);for(var k in l)if(l.hasOwnProperty(k)){var P=u[k],j=l[k];v(j,O,w,A,F),P.rules&&c({$form:g,rules:P.rules,submitEvent:T,resetFormEvent:w,resetValues:F,resetErrors:B,validateFormEvent:b,field:j,formValidationEvents:s||["submit"],fieldValidationEvents:P.validateOn?P.validateOn:[]})}return i({source:C,filter:$,target:S}),i({source:D,filter:$,target:S}),{fields:l,$values:g,$eachValid:E,$isValid:E,$isDirty:x,$touched:V,submit:T,validate:b,resetTouched:A,reset:w,resetValues:F,resetErrors:B,setForm:O,set:O,formValidated:S}}function h(r){var e=u(r.$value),t=u(r.$errors),n=u(r.$firstError),o=u(r.$isValid),i=u(r.$isDirty),s=u(r.$touched);return{name:r.name,value:e,errors:t,firstError:n,isValid:o,isDirty:i,touched:s,isTouched:s,onChange:r.onChange,onBlur:r.onBlur,addError:r.addError,validate:r.validate,reset:r.reset,set:r.onChange,resetErrors:r.resetErrors,hasError:function(){return null!==n},errorText:function(r){return n?r&&r[n.rule]?r[n.rule]:n.errorText||"":""}}}function p(r){var e={};for(var t in r.fields)if(r.fields.hasOwnProperty(t)){var n=r.fields[t];e[t]=h(n)}var o=u(r.$values),i=u(r.$eachValid),s=u(r.$isDirty),a=u(r.$touched);return{fields:e,values:o,hasError:function(r){return r?!!e[r]&&Boolean(e[r].firstError):!i},eachValid:i,isValid:i,isDirty:s,isTouched:a,touched:a,errors:function(r){return e[r]?e[r].errors:[]},error:function(r){return e[r]?e[r].firstError:null},reset:r.reset,errorText:function(r,t){var n=e[r];return n&&n.firstError?t&&t[n.firstError.rule]?t[n.firstError.rule]:n.firstError.errorText||"":""},submit:r.submit,setForm:r.setForm,set:r.setForm,formValidated:r.formValidated}}export{m as createForm,h as useField,p as useForm};
//# sourceMappingURL=index.js.map
