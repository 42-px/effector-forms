import{combine as e,createStore as r,createEvent as t,sample as o,guard as i}from"effector";import{useStore as n}from"effector-react";const s={store:function({init:e,domain:t,existing:o}){return o||(t?t.store(e):r(e))},event:function({domain:e,existing:r}){return r||(e?e.event():t())}};function l(e,r,t){var o,i,n,l,u,a,d,c,f,v;const m="function"==typeof r.init?r.init():r.init,h=s.store({domain:t,existing:null===(o=r.units)||void 0===o?void 0:o.$value,init:m}),$=s.store({domain:t,existing:null===(i=r.units)||void 0===i?void 0:i.$errors,init:[]}),g=$.map(e=>e[0]?e[0]:null),E=h.map(e=>e!==m),p=s.store({domain:t,existing:null===(n=r.units)||void 0===n?void 0:n.$isTouched,init:!1}),x=s.event({domain:t,existing:null===(l=r.units)||void 0===l?void 0:l.onChange}),V=s.event({domain:t,existing:null===(u=r.units)||void 0===u?void 0:u.onBlur}),y=s.event({domain:t,existing:null===(a=r.units)||void 0===a?void 0:a.changed}),T=s.event({domain:t,existing:null===(d=r.units)||void 0===d?void 0:d.addError}),b=s.event({domain:t,existing:null===(c=r.units)||void 0===c?void 0:c.validate}),F=s.event({domain:t,existing:null===(f=r.units)||void 0===f?void 0:f.resetErrors}),O=s.event({domain:t,existing:null===(v=r.units)||void 0===v?void 0:v.reset});return{changed:y,name:e,$value:h,$errors:$,$firstError:g,$isValid:g.map(e=>null===e),$isDirty:E,$isTouched:p,$touched:p,onChange:x,onBlur:V,addError:T,validate:b,set:x,reset:O,resetErrors:F,filter:r.filter}}function u({$form:t,validateFormEvent:i,submitEvent:n,resetFormEvent:s,field:l,rules:u,formValidationEvents:a,fieldValidationEvents:d}){const{$value:c,$errors:f,onBlur:v,changed:m,addError:h,validate:$,resetErrors:g,reset:E}=l,p=e(u.map(({source:e})=>e||r(null))),x=function(e){return(r,t,o)=>{const i=[];for(let n=0;n<e.length;n++){const s=e[n],l=o?o[n]:null,u=s.validator(r,t,l);"boolean"!=typeof u||u||i.push({rule:s.name,errorText:s.errorText,value:r}),"object"!=typeof u||u.isValid||i.push({rule:s.name,errorText:u.errorText,value:r})}return i}}(u),V=[...a,...d],y=[];V.includes("submit")&&y.push(o({source:e({fieldValue:c,form:t,rulesSources:p}),clock:n})),V.includes("blur")&&y.push(o({source:e({fieldValue:c,form:t,rulesSources:p}),clock:v})),V.includes("change")&&y.push(o({source:e({fieldValue:c,form:t,rulesSources:p}),clock:m})),y.push(o({source:e({fieldValue:c,form:t,rulesSources:p}),clock:$})),y.push(o({source:e({fieldValue:c,form:t,rulesSources:p}),clock:i}));const T=o({source:c,clock:h,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})});f.on(y,(e,{form:r,fieldValue:t,rulesSources:o})=>x(t,r,o)).on(T,(e,r)=>[r,...e]).reset(g,s,E),V.includes("change")||f.reset(m)}function a({$value:e,$touched:r,onChange:t,changed:o,name:n,reset:s,filter:l},u,a,d){r.on(o,()=>!0).reset(s,a,d),i({source:t,filter:l||(()=>!0),target:o}),e.on(o,(e,r)=>r).on(u,(e,r)=>r.hasOwnProperty(n)?r[n]:e).reset(s,a)}function d(r){const{filter:t,domain:n,fields:d,validateOn:c,units:f}=r,v={},m=[],h=[];for(const e in d){if(!d.hasOwnProperty(e))continue;const r=l(e,d[e],n);v[e]=r,m.push(r.$isDirty),h.push(r.$touched)}const $=function(r){const t={};for(const e in r)r.hasOwnProperty(e)&&(t[e]=r[e].$value);return e(t)}(v),g=function(r){const t=[];for(const e in r){if(!r.hasOwnProperty(e))continue;const{$firstError:o}=r[e];t.push(o)}return e(t).map(e=>e.every(e=>null===e))}(v),E=t?e(g,t,(e,r)=>e&&r):g,p=e(m).map(e=>e.some(Boolean)),x=e(h).map(e=>e.some(Boolean)),V=s.event({domain:n,existing:null==f?void 0:f.validate}),y=s.event({domain:n,existing:null==f?void 0:f.submit}),T=s.event({domain:n,existing:null==f?void 0:f.formValidated}),b=s.event({domain:n,existing:null==f?void 0:f.setForm}),F=s.event({domain:n,existing:null==f?void 0:f.reset}),O=s.event({domain:n,existing:null==f?void 0:f.resetTouched}),B=o($,y),D=o($,V);for(const e in v){if(!v.hasOwnProperty(e))continue;const r=d[e],t=v[e];a(t,b,F,O),r.rules&&u({$form:$,rules:r.rules,submitEvent:y,resetFormEvent:F,validateFormEvent:V,field:t,formValidationEvents:c||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return i({source:B,filter:E,target:T}),i({source:D,filter:E,target:T}),{fields:v,$values:$,$eachValid:g,$isValid:g,$isDirty:p,$touched:x,submit:y,validate:V,resetTouched:O,reset:F,setForm:b,set:b,formValidated:T}}function c(e){const r=n(e.$value),t=n(e.$errors),o=n(e.$firstError),i=n(e.$isValid),s=n(e.$isDirty),l=n(e.$touched);return{name:e.name,value:r,errors:t,firstError:o,isValid:i,isDirty:s,touched:l,isTouched:l,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==o,errorText:e=>o?e&&e[o.rule]?e[o.rule]:o.errorText||"":""}}function f(e){const r={};for(const t in e.fields){if(!e.fields.hasOwnProperty(t))continue;const o=e.fields[t];r[t]=c(o)}const t=n(e.$values),o=n(e.$eachValid),i=n(e.$isDirty),s=n(e.$touched);return{fields:r,values:t,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!o,eachValid:o,isValid:o,isDirty:i,isTouched:s,touched:s,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,reset:e.reset,errorText:(e,t)=>{const o=r[e];return o&&o.firstError?t&&t[o.firstError.rule]?t[o.firstError.rule]:o.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}}export{d as createForm,c as useField,f as useForm};
//# sourceMappingURL=index.js.map
