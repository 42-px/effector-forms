import{combine as e,createStore as r,createEvent as t,sample as o,merge as i,guard as n}from"effector";import{useStore as s}from"effector-react";const l={store:function({init:e,domain:t,existing:o}){return o||(t?t.store(e):r(e))},event:function({domain:e,existing:r}){return r||(e?e.event():t())}};function u(e,r,t){var o,i,n,s,u,a,d,c,v,f,m;const h="function"==typeof r.init?r.init():r.init,g=l.store({domain:t,existing:null===(o=r.units)||void 0===o?void 0:o.$value,init:h}),E=l.store({domain:t,existing:null===(i=r.units)||void 0===i?void 0:i.$errors,init:[]}),$=E.map(e=>e[0]?e[0]:null),x=g.map(e=>e!==h),V=l.store({domain:t,existing:null===(n=r.units)||void 0===n?void 0:n.$isTouched,init:!1}),p=l.event({domain:t,existing:null===(s=r.units)||void 0===s?void 0:s.onChange}),y=l.event({domain:t,existing:null===(u=r.units)||void 0===u?void 0:u.onBlur}),T=l.event({domain:t,existing:null===(a=r.units)||void 0===a?void 0:a.changed}),b=l.event({domain:t,existing:null===(d=r.units)||void 0===d?void 0:d.addError}),F=l.event({domain:t,existing:null===(c=r.units)||void 0===c?void 0:c.validate}),O=l.event({domain:t,existing:null===(v=r.units)||void 0===v?void 0:v.resetErrors}),B=l.event({domain:t,existing:null===(f=r.units)||void 0===f?void 0:f.resetValue}),D=l.event({domain:t,existing:null===(m=r.units)||void 0===m?void 0:m.reset});return{changed:T,name:e,$value:g,$errors:E,$firstError:$,$isValid:$.map(e=>null===e),$isDirty:x,$isTouched:V,$touched:V,onChange:p,onBlur:y,addError:b,validate:F,set:p,reset:D,resetErrors:O,resetValue:B,filter:r.filter}}function a({$form:t,validateFormEvent:n,submitEvent:s,resetFormEvent:l,resetValues:u,field:a,rules:d,resetErrors:c,formValidationEvents:v,fieldValidationEvents:f}){const{$value:m,$errors:h,onBlur:g,changed:E,addError:$,validate:x,resetErrors:V,resetValue:p,reset:y}=a,T=e(d.map(({source:e})=>e||r(null))),b=function(e){return(r,t,o)=>{const i=[];for(let n=0;n<e.length;n++){const s=e[n],l=o?o[n]:null,u=s.validator(r,t,l);"boolean"!=typeof u||u||i.push({rule:s.name,errorText:s.errorText,value:r}),"object"!=typeof u||u.isValid||i.push({rule:s.name,errorText:u.errorText,value:r})}return i}}(d),F=[...v,...f],O=[];F.includes("submit")&&O.push(o({source:e({fieldValue:m,form:t,rulesSources:T}),clock:s})),F.includes("blur")&&O.push(o({source:e({fieldValue:m,form:t,rulesSources:T}),clock:g})),F.includes("change")&&O.push(o({source:e({fieldValue:m,form:t,rulesSources:T}),clock:i([E,p,u])})),O.push(o({source:e({fieldValue:m,form:t,rulesSources:T}),clock:x})),O.push(o({source:e({fieldValue:m,form:t,rulesSources:T}),clock:n}));const B=o({source:m,clock:$,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})});h.on(O,(e,{form:r,fieldValue:t,rulesSources:o})=>b(t,r,o)).on(B,(e,r)=>[r,...e]).reset(V,l,y,c),F.includes("change")||h.reset(E)}function d({$value:e,$touched:r,onChange:t,changed:o,name:i,reset:s,resetValue:l,filter:u},a,d,c,v){r.on(o,()=>!0).reset(s,d,c),n({source:t,filter:u||(()=>!0),target:o}),e.on(o,(e,r)=>r).on(a,(e,r)=>r.hasOwnProperty(i)?r[i]:e).reset(s,l,v,d)}function c(r){const{filter:t,domain:i,fields:s,validateOn:c,units:v}=r,f={},m=[],h=[];for(const e in s){if(!s.hasOwnProperty(e))continue;const r=u(e,s[e],i);f[e]=r,m.push(r.$isDirty),h.push(r.$touched)}const g=function(r){const t={};for(const e in r)r.hasOwnProperty(e)&&(t[e]=r[e].$value);return e(t)}(f),E=function(r){const t=[];for(const e in r){if(!r.hasOwnProperty(e))continue;const{$firstError:o}=r[e];t.push(o)}return e(t).map(e=>e.every(e=>null===e))}(f),$=t?e(E,t,(e,r)=>e&&r):E,x=e(m).map(e=>e.some(Boolean)),V=e(h).map(e=>e.some(Boolean)),p=l.event({domain:i,existing:null==v?void 0:v.validate}),y=l.event({domain:i,existing:null==v?void 0:v.submit}),T=l.event({domain:i,existing:null==v?void 0:v.formValidated}),b=l.event({domain:i,existing:null==v?void 0:v.setForm}),F=l.event({domain:i,existing:null==v?void 0:v.reset}),O=l.event({domain:i,existing:null==v?void 0:v.resetValues}),B=l.event({domain:i,existing:null==v?void 0:v.resetErrors}),D=l.event({domain:i,existing:null==v?void 0:v.resetTouched}),k=o(g,y),w=o(g,p);for(const e in f){if(!f.hasOwnProperty(e))continue;const r=s[e],t=f[e];d(t,b,F,D,O),r.rules&&a({$form:g,rules:r.rules,submitEvent:y,resetFormEvent:F,resetValues:O,resetErrors:B,validateFormEvent:p,field:t,formValidationEvents:c||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return n({source:k,filter:$,target:T}),n({source:w,filter:$,target:T}),{fields:f,$values:g,$eachValid:E,$isValid:E,$isDirty:x,$touched:V,submit:y,validate:p,resetTouched:D,reset:F,resetValues:O,resetErrors:B,setForm:b,set:b,formValidated:T}}function v(e){const r=s(e.$value),t=s(e.$errors),o=s(e.$firstError),i=s(e.$isValid),n=s(e.$isDirty),l=s(e.$touched);return{name:e.name,value:r,errors:t,firstError:o,isValid:i,isDirty:n,touched:l,isTouched:l,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==o,errorText:e=>o?e&&e[o.rule]?e[o.rule]:o.errorText||"":""}}function f(e){const r={};for(const t in e.fields){if(!e.fields.hasOwnProperty(t))continue;const o=e.fields[t];r[t]=v(o)}const t=s(e.$values),o=s(e.$eachValid),i=s(e.$isDirty),n=s(e.$touched);return{fields:r,values:t,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!o,eachValid:o,isValid:o,isDirty:i,isTouched:n,touched:n,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,reset:e.reset,errorText:(e,t)=>{const o=r[e];return o&&o.firstError?t&&t[o.firstError.rule]?t[o.firstError.rule]:o.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}}export{c as createForm,v as useField,f as useForm};
//# sourceMappingURL=index.js.map
