import{combine as e,createStore as r,createEvent as t,sample as o,guard as i}from"effector";import{useStore as n}from"effector-react";const s={store:function({init:e,domain:t,existing:o}){return o||(t?t.store(e):r(e))},event:function({domain:e,existing:r}){return r||(e?e.event():t())}};function l(e,r,t){var o,i,n,l,u,a,d,c,f,v;const m="function"==typeof r.init?r.init():r.init,h=s.store({domain:t,existing:null===(o=r.units)||void 0===o?void 0:o.$value,init:m}),$=s.store({domain:t,existing:null===(i=r.units)||void 0===i?void 0:i.$errors,init:[]}),g=$.map(e=>e[0]?e[0]:null),E=h.map(e=>e!==m),x=s.store({domain:t,existing:null===(n=r.units)||void 0===n?void 0:n.$isTouched,init:!1}),p=s.event({domain:t,existing:null===(l=r.units)||void 0===l?void 0:l.onChange}),V=s.event({domain:t,existing:null===(u=r.units)||void 0===u?void 0:u.onBlur}),y=s.event({domain:t,existing:null===(a=r.units)||void 0===a?void 0:a.changed}),T=s.event({domain:t,existing:null===(d=r.units)||void 0===d?void 0:d.addError}),b=s.event({domain:t,existing:null===(c=r.units)||void 0===c?void 0:c.validate}),O=s.event({domain:t,existing:null===(f=r.units)||void 0===f?void 0:f.resetErrors}),B=s.event({domain:t,existing:null===(v=r.units)||void 0===v?void 0:v.reset});return{changed:y,name:e,$value:h,$errors:$,$firstError:g,$isValid:g.map(e=>null===e),$isDirty:E,$isTouched:x,$touched:x,onChange:p,onBlur:V,addError:T,validate:b,set:p,reset:B,resetErrors:O,filter:r.filter}}function u({$form:r,submitEvent:t,resetFormEvent:i,field:n,rules:s,formValidationEvents:l,fieldValidationEvents:u}){const{$value:a,$errors:d,onBlur:c,changed:f,addError:v,validate:m,resetErrors:h,reset:$}=n,g=function(e){return(r,t)=>{const o=[];for(const i of e){const e=i.validator(r,t);"boolean"!=typeof e||e||o.push({rule:i.name,errorText:i.errorText,value:r}),"object"!=typeof e||e.isValid||o.push({rule:i.name,errorText:e.errorText,value:r})}return o}}(s),E=[...l,...u],x=[];E.includes("submit")&&x.push(o({source:e({fieldValue:a,form:r}),clock:t})),E.includes("blur")&&x.push(o({source:e({fieldValue:a,form:r}),clock:c})),E.includes("change")&&x.push(o({source:e({fieldValue:a,form:r}),clock:f})),x.push(o({source:e({fieldValue:a,form:r}),clock:m}));const p=o({source:a,clock:v,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})});d.on(x,(e,{form:r,fieldValue:t})=>g(t,r)).on(p,(e,r)=>[r,...e]).reset(h,i,$),E.includes("change")||d.reset(f)}function a({$value:e,$touched:r,onChange:t,changed:o,name:n,reset:s,filter:l},u,a,d){r.on(o,()=>!0).reset(s,a,d),i({source:t,filter:l||(()=>!0),target:o}),e.on(o,(e,r)=>r).on(u,(e,r)=>r.hasOwnProperty(n)?r[n]:e).reset(s,a)}function d(r){const{filter:t,domain:n,fields:d,validateOn:c,units:f}=r,v={},m=[],h=[];for(const e in d){if(!d.hasOwnProperty(e))continue;const r=l(e,d[e],n);v[e]=r,m.push(r.$isDirty),h.push(r.$touched)}const $=function(r){const t={};for(const e in r)r.hasOwnProperty(e)&&(t[e]=r[e].$value);return e(t)}(v),g=function(r){const t=[];for(const e in r){if(!r.hasOwnProperty(e))continue;const{$firstError:o}=r[e];t.push(o)}return e(t).map(e=>e.every(e=>null===e))}(v),E=t?e(g,t,(e,r)=>e&&r):g,x=e(m).map(e=>e.some(Boolean)),p=e(h).map(e=>e.some(Boolean)),V=s.event({domain:n,existing:null==f?void 0:f.submit}),y=s.event({domain:n,existing:null==f?void 0:f.formValidated}),T=s.event({domain:n,existing:null==f?void 0:f.setForm}),b=s.event({domain:n,existing:null==f?void 0:f.reset}),O=s.event({domain:n,existing:null==f?void 0:f.resetTouched}),B=o($,V);for(const e in v){if(!v.hasOwnProperty(e))continue;const r=d[e],t=v[e];a(t,T,b,O),r.rules&&u({$form:$,rules:r.rules,submitEvent:V,resetFormEvent:b,field:t,formValidationEvents:c||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return i({source:B,filter:E,target:y}),{fields:v,$values:$,$eachValid:g,$isValid:g,$isDirty:x,$touched:p,submit:V,resetTouched:O,reset:b,setForm:T,set:T,formValidated:y}}function c(e){const r=n(e.$value),t=n(e.$errors),o=n(e.$firstError),i=n(e.$isValid),s=n(e.$isDirty),l=n(e.$touched);return{name:e.name,value:r,errors:t,firstError:o,isValid:i,isDirty:s,touched:l,isTouched:l,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==o,errorText:e=>o?e&&e[o.rule]?e[o.rule]:o.errorText||"":""}}function f(e){const r={};for(const t in e.fields){if(!e.fields.hasOwnProperty(t))continue;const o=e.fields[t];r[t]=c(o)}const t=n(e.$values),o=n(e.$eachValid),i=n(e.$isDirty),s=n(e.$touched);return{fields:r,values:t,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!o,eachValid:o,isValid:o,isDirty:i,isTouched:s,touched:s,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,reset:e.reset,errorText:(e,t)=>{const o=r[e];return o&&o.firstError?t&&t[o.firstError.rule]?t[o.firstError.rule]:o.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}}export{d as createForm,c as useField,f as useForm};
//# sourceMappingURL=index.js.map
