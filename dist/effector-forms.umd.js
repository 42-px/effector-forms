!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("effector"),require("effector-react")):"function"==typeof define&&define.amd?define(["exports","effector","effector-react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).EffectorForm={},e.effector,e.effectorReact)}(this,(function(e,r,o){"use strict";const t={store:function({init:e,domain:o,existing:t}){return t||(o?o.store(e):r.createStore(e))},event:function({domain:e,existing:o}){return o||(e?e.event():r.createEvent())}};function i(e,r,o){var i,n,s,u,l,a,d,c,f,m;const v="function"==typeof r.init?r.init():r.init,h=t.store({domain:o,existing:null===(i=r.units)||void 0===i?void 0:i.$value,init:v}),p=t.store({domain:o,existing:null===(n=r.units)||void 0===n?void 0:n.$errors,init:[]}),g=p.map(e=>e[0]?e[0]:null),$=h.map(e=>e!==v),E=t.store({domain:o,existing:null===(s=r.units)||void 0===s?void 0:s.$isTouched,init:!1}),x=t.event({domain:o,existing:null===(u=r.units)||void 0===u?void 0:u.onChange}),b=t.event({domain:o,existing:null===(l=r.units)||void 0===l?void 0:l.onBlur}),y=t.event({domain:o,existing:null===(a=r.units)||void 0===a?void 0:a.changed}),V=t.event({domain:o,existing:null===(d=r.units)||void 0===d?void 0:d.addError}),T=t.event({domain:o,existing:null===(c=r.units)||void 0===c?void 0:c.validate}),S=t.event({domain:o,existing:null===(f=r.units)||void 0===f?void 0:f.resetErrors}),F=t.event({domain:o,existing:null===(m=r.units)||void 0===m?void 0:m.reset});return{changed:y,name:e,$value:h,$errors:p,$firstError:g,$isValid:g.map(e=>null===e),$isDirty:$,$isTouched:E,$touched:E,onChange:x,onBlur:b,addError:V,validate:T,set:x,reset:F,resetErrors:S,filter:r.filter}}function n({$form:e,submitEvent:o,resetFormEvent:t,field:i,rules:n,formValidationEvents:s,fieldValidationEvents:u}){const{$value:l,$errors:a,onBlur:d,changed:c,addError:f,validate:m,resetErrors:v,reset:h}=i,p=r.combine(n.map(({source:e})=>e||r.createStore(null))),g=function(e){return(r,o,t)=>{const i=[];for(let n=0;n<e.length;n++){const s=e[n],u=t?t[n]:null,l=s.validator(r,o,u);"boolean"!=typeof l||l||i.push({rule:s.name,errorText:s.errorText,value:r}),"object"!=typeof l||l.isValid||i.push({rule:s.name,errorText:l.errorText,value:r})}return i}}(n),$=[...s,...u],E=[];$.includes("submit")&&E.push(r.sample({source:r.combine({fieldValue:l,form:e,rulesSources:p}),clock:o})),$.includes("blur")&&E.push(r.sample({source:r.combine({fieldValue:l,form:e,rulesSources:p}),clock:d})),$.includes("change")&&E.push(r.sample({source:r.combine({fieldValue:l,form:e,rulesSources:p}),clock:c})),E.push(r.sample({source:r.combine({fieldValue:l,form:e,rulesSources:p}),clock:m}));const x=r.sample({source:l,clock:f,fn:(e,{rule:r,errorText:o})=>({rule:r,value:e,errorText:o})});a.on(E,(e,{form:r,fieldValue:o,rulesSources:t})=>g(o,r,t)).on(x,(e,r)=>[r,...e]).reset(v,t,h),$.includes("change")||a.reset(c)}function s({$value:e,$touched:o,onChange:t,changed:i,name:n,reset:s,filter:u},l,a,d){o.on(i,()=>!0).reset(s,a,d),r.guard({source:t,filter:u||(()=>!0),target:i}),e.on(i,(e,r)=>r).on(l,(e,r)=>r.hasOwnProperty(n)?r[n]:e).reset(s,a)}function u(e){const r=o.useStore(e.$value),t=o.useStore(e.$errors),i=o.useStore(e.$firstError),n=o.useStore(e.$isValid),s=o.useStore(e.$isDirty),u=o.useStore(e.$touched);return{name:e.name,value:r,errors:t,firstError:i,isValid:n,isDirty:s,touched:u,isTouched:u,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==i,errorText:e=>i?e&&e[i.rule]?e[i.rule]:i.errorText||"":""}}e.createForm=function(e){const{filter:o,domain:u,fields:l,validateOn:a,units:d}=e,c={},f=[],m=[];for(const e in l){if(!l.hasOwnProperty(e))continue;const r=i(e,l[e],u);c[e]=r,f.push(r.$isDirty),m.push(r.$touched)}const v=function(e){const o={};for(const r in e)e.hasOwnProperty(r)&&(o[r]=e[r].$value);return r.combine(o)}(c),h=function(e){const o=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const{$firstError:t}=e[r];o.push(t)}return r.combine(o).map(e=>e.every(e=>null===e))}(c),p=o?r.combine(h,o,(e,r)=>e&&r):h,g=r.combine(f).map(e=>e.some(Boolean)),$=r.combine(m).map(e=>e.some(Boolean)),E=t.event({domain:u,existing:null==d?void 0:d.submit}),x=t.event({domain:u,existing:null==d?void 0:d.formValidated}),b=t.event({domain:u,existing:null==d?void 0:d.setForm}),y=t.event({domain:u,existing:null==d?void 0:d.reset}),V=t.event({domain:u,existing:null==d?void 0:d.resetTouched}),T=r.sample(v,E);for(const e in c){if(!c.hasOwnProperty(e))continue;const r=l[e],o=c[e];s(o,b,y,V),r.rules&&n({$form:v,rules:r.rules,submitEvent:E,resetFormEvent:y,field:o,formValidationEvents:a||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return r.guard({source:T,filter:p,target:x}),{fields:c,$values:v,$eachValid:h,$isValid:h,$isDirty:g,$touched:$,submit:E,resetTouched:V,reset:y,setForm:b,set:b,formValidated:x}},e.useField=u,e.useForm=function(e){const r={};for(const o in e.fields){if(!e.fields.hasOwnProperty(o))continue;const t=e.fields[o];r[o]=u(t)}const t=o.useStore(e.$values),i=o.useStore(e.$eachValid),n=o.useStore(e.$isDirty),s=o.useStore(e.$touched);return{fields:r,values:t,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!i,eachValid:i,isValid:i,isDirty:n,isTouched:s,touched:s,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,reset:e.reset,errorText:(e,o)=>{const t=r[e];return t&&t.firstError?o&&o[t.firstError.rule]?o[t.firstError.rule]:t.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=effector-forms.umd.js.map
