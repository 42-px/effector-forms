!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("effector"),require("effector-react")):"function"==typeof define&&define.amd?define(["exports","effector","effector-react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).EffectorForm={},e.effector,e.effectorReact)}(this,(function(e,r,t){"use strict";const o={store:function({init:e,domain:t,existing:o}){return o||(t?t.store(e):r.createStore(e))},event:function({domain:e,existing:t}){return t||(e?e.event():r.createEvent())}};function i(e,t,i){var n,s,l,u,a,d,c,f,m,v,h;const p="function"==typeof t.init?t.init():t.init,g=o.store({domain:i,existing:null===(n=t.units)||void 0===n?void 0:n.$value,init:p}),E=o.store({domain:i,existing:null===(s=t.units)||void 0===s?void 0:s.$errors,init:[]}),x=E.map(e=>e[0]?e[0]:null),V=g.map(e=>e!==p),$=o.store({domain:i,existing:null===(l=t.units)||void 0===l?void 0:l.$isTouched,init:!1}),b=o.event({domain:i,existing:null===(u=t.units)||void 0===u?void 0:u.onChange}),y=o.event({domain:i,existing:null===(a=t.units)||void 0===a?void 0:a.onBlur}),T=o.event({domain:i,existing:null===(d=t.units)||void 0===d?void 0:d.changed}),F=o.event({domain:i,existing:null===(c=t.units)||void 0===c?void 0:c.addError}),S=o.event({domain:i,existing:null===(f=t.units)||void 0===f?void 0:f.validate}),O=o.event({domain:i,existing:null===(m=t.units)||void 0===m?void 0:m.resetErrors}),D=o.event({domain:i,existing:null===(v=t.units)||void 0===v?void 0:v.resetValue}),B=o.event({domain:i,existing:null===(h=t.units)||void 0===h?void 0:h.reset}),P=x.map(e=>null===e);return{changed:T,name:e,$value:g,$errors:E,$firstError:x,$isValid:P,$isDirty:V,$isTouched:$,$touched:$,$field:r.combine({value:g,errors:E,firstError:x,isValid:P,isDirty:V,isTouched:$}),onChange:b,onBlur:y,addError:F,validate:S,set:b,reset:B,resetErrors:O,resetValue:D,filter:t.filter}}function n({$form:e,validateFormEvent:t,submitEvent:o,resetFormEvent:i,resetValues:n,field:s,rules:l,resetErrors:u,formValidationEvents:a,fieldValidationEvents:d}){const{$value:c,$errors:f,onBlur:m,changed:v,addError:h,validate:p,resetErrors:g,resetValue:E,reset:x}=s,V="function"==typeof l?r.createStore([]):r.combine(l.map(({source:e})=>e||r.createStore(null))),$=(b=l,(e,r,t)=>{const o=[],i="function"==typeof b?b(e,r):b;for(let n=0;n<i.length;n++){const s=i[n],l=t?t[n]:null,u=s.validator(e,r,l);"boolean"!=typeof u||u||o.push({rule:s.name,errorText:s.errorText,value:e}),"object"!=typeof u||u.isValid||o.push({rule:s.name,errorText:u.errorText,value:e})}return o});var b;const y=[...a,...d],T=[];if(y.includes("submit")){const t=r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:V}),clock:o});T.push(t)}y.includes("blur")&&T.push(r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:V}),clock:m})),y.includes("change")&&T.push(r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:V}),clock:r.merge([v,E,n])})),T.push(r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:V}),clock:p})),T.push(r.sample({source:r.combine({fieldValue:c,form:e,rulesSources:V}),clock:t}));const F=r.sample({source:c,clock:h,fn:(e,{rule:r,errorText:t})=>({rule:r,value:e,errorText:t})});f.on(T,(e,{form:r,fieldValue:t,rulesSources:o})=>$(t,r,o)).on(F,(e,r)=>[r,...e]).reset(g,i,x,u),y.includes("change")||f.reset(v)}function s({$value:e,$touched:t,onChange:o,changed:i,name:n,reset:s,resetValue:l,filter:u},a,d,c,f){t.on(i,()=>!0).reset(s,d,c),r.guard({source:o,filter:u||(()=>!0),target:i}),e.on(i,(e,r)=>r).on(a,(e,r)=>r.hasOwnProperty(n)?r[n]:e).reset(s,l,f,d)}function l(e){const{value:r,errors:o,firstError:i,isValid:n,isDirty:s,isTouched:l}=t.useStore(e.$field);return{name:e.name,value:r,errors:o,firstError:i,isValid:n,isDirty:s,touched:l,isTouched:l,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:()=>null!==i,errorText:e=>i?e&&e[i.rule]?e[i.rule]:i.errorText||"":""}}e.createForm=function(e){const{filter:t,domain:l,fields:u,validateOn:a,units:d}=e,c={},f=[],m=[];for(const e in u){if(!u.hasOwnProperty(e))continue;const r=i(e,u[e],l);c[e]=r,f.push(r.$isDirty),m.push(r.$touched)}const v=function(e){const t={};for(const r in e)e.hasOwnProperty(r)&&(t[r]=e[r].$value);return r.combine(t)}(c),h=function(e){const t=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const{$firstError:o}=e[r];t.push(o)}return r.combine(t).map(e=>e.every(e=>null===e))}(c),p=t?r.combine(h,t,(e,r)=>e&&r):h,g=r.combine(f).map(e=>e.some(Boolean)),E=r.combine(m).map(e=>e.some(Boolean)),x=r.combine({isValid:h,isDirty:g,touched:E}),V=o.event({domain:l,existing:null==d?void 0:d.validate}),$=o.event({domain:l,existing:null==d?void 0:d.submit}),b=o.event({domain:l,existing:null==d?void 0:d.formValidated}),y=o.event({domain:l,existing:null==d?void 0:d.setForm}),T=o.event({domain:l,existing:null==d?void 0:d.reset}),F=o.event({domain:l,existing:null==d?void 0:d.resetValues}),S=o.event({domain:l,existing:null==d?void 0:d.resetErrors}),O=o.event({domain:l,existing:null==d?void 0:d.resetTouched}),D=r.sample(v,$),B=r.sample(v,V);for(const e in c){if(!c.hasOwnProperty(e))continue;const r=u[e],t=c[e];s(t,y,T,O,F),r.rules&&n({$form:v,rules:r.rules,submitEvent:$,resetFormEvent:T,resetValues:F,resetErrors:S,validateFormEvent:V,field:t,formValidationEvents:a||["submit"],fieldValidationEvents:r.validateOn?r.validateOn:[]})}return r.guard({source:D,filter:p,target:b}),r.guard({source:B,filter:p,target:b}),{fields:c,$values:v,$eachValid:h,$isValid:h,$isDirty:g,$touched:E,$meta:x,submit:$,validate:V,resetTouched:O,reset:T,resetValues:F,resetErrors:S,setForm:y,set:y,formValidated:b}},e.useField=l,e.useForm=function(e){const r={},o={};for(const t in e.fields){if(!e.fields.hasOwnProperty(t))continue;const i=l(e.fields[t]);r[t]=i,o[t]=i.value}const{isValid:i,isDirty:n,touched:s}=t.useStore(e.$meta);return{fields:r,values:o,hasError:e=>e?!!r[e]&&Boolean(r[e].firstError):!i,eachValid:i,isValid:i,isDirty:n,isTouched:s,touched:s,errors:e=>r[e]?r[e].errors:[],error:e=>r[e]?r[e].firstError:null,reset:e.reset,errorText:(e,t)=>{const o=r[e];return o&&o.firstError?t&&t[o.firstError.rule]?t[o.firstError.rule]:o.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=effector-forms.umd.js.map
