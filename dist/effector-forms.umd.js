!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("effector"),require("effector-react")):"function"==typeof define&&define.amd?define(["exports","effector","effector-react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).EffectorForm={},e.effector,e.effectorReact)}(this,(function(e,r,t){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"==typeof e)return i(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var u={store:function(e){var t=e.init,n=e.domain,o=e.existing;return o||(n?n.store(t):r.createStore(t))},event:function(e){var t=e.domain,n=e.existing;return n||(t?t.event():r.createEvent())}};function s(e,r,t){var n,o,i,s,a,l,d,f,c,v,m,p="function"==typeof r.init?r.init():r.init,h=u.store({domain:t,existing:null===(n=r.units)||void 0===n?void 0:n.$value,init:p}),y=u.store({domain:t,existing:null===(o=r.units)||void 0===o?void 0:o.$errors,init:[]}),g=y.map((function(e){return e[0]?e[0]:null})),b=h.map((function(e){return e!==p})),E=u.store({domain:t,existing:null===(i=r.units)||void 0===i?void 0:i.$isTouched,init:!1}),$=u.event({domain:t,existing:null===(s=r.units)||void 0===s?void 0:s.onChange}),x=u.event({domain:t,existing:null===(a=r.units)||void 0===a?void 0:a.onBlur}),V=u.event({domain:t,existing:null===(l=r.units)||void 0===l?void 0:l.changed}),S=u.event({domain:t,existing:null===(d=r.units)||void 0===d?void 0:d.addError}),T=u.event({domain:t,existing:null===(f=r.units)||void 0===f?void 0:f.validate}),F=u.event({domain:t,existing:null===(c=r.units)||void 0===c?void 0:c.resetErrors}),O=u.event({domain:t,existing:null===(v=r.units)||void 0===v?void 0:v.resetValue}),w=u.event({domain:t,existing:null===(m=r.units)||void 0===m?void 0:m.reset});return{changed:V,name:e,$value:h,$errors:y,$firstError:g,$isValid:g.map((function(e){return null===e})),$isDirty:b,$isTouched:E,$touched:E,onChange:$,onBlur:x,addError:S,validate:T,set:$,reset:w,resetErrors:F,resetValue:O,filter:r.filter}}function a(e){var t,i=e.$form,u=e.validateFormEvent,s=e.submitEvent,a=e.resetFormEvent,l=e.resetValues,d=e.field,f=e.rules,c=e.resetErrors,v=e.formValidationEvents,m=e.fieldValidationEvents,p=d.$value,h=d.$errors,y=d.onBlur,g=d.changed,b=d.addError,E=d.validate,$=d.resetErrors,x=d.resetValue,V=d.reset,S="function"==typeof f?r.createStore([]):r.combine(f.map((function(e){return e.source||r.createStore(null)}))),T=(t=f,function(e,r,o){for(var i=[],u="function"==typeof t?t(e,r):t,s=0;s<u.length;s++){var a=u[s],l=o?o[s]:null,d=a.validator(e,r,l);"boolean"!=typeof d||d||i.push({rule:a.name,errorText:a.errorText,value:e}),"object"!==n(d)||d.isValid||i.push({rule:a.name,errorText:d.errorText,value:e})}return i}),F=[].concat(o(v),o(m)),O=[];F.includes("submit")&&O.push(r.sample({source:r.combine({fieldValue:p,form:i,rulesSources:S}),clock:s})),F.includes("blur")&&O.push(r.sample({source:r.combine({fieldValue:p,form:i,rulesSources:S}),clock:y})),F.includes("change")&&O.push(r.sample({source:r.combine({fieldValue:p,form:i,rulesSources:S}),clock:r.merge([g,x,l])})),O.push(r.sample({source:r.combine({fieldValue:p,form:i,rulesSources:S}),clock:E})),O.push(r.sample({source:r.combine({fieldValue:p,form:i,rulesSources:S}),clock:u}));var w=r.sample({source:p,clock:b,fn:function(e,r){return{rule:r.rule,value:e,errorText:r.errorText}}});h.on(O,(function(e,r){var t=r.form,n=r.fieldValue,o=r.rulesSources;return T(n,t,o)})).on(w,(function(e,r){return[r].concat(o(e))})).reset($,a,V,c),F.includes("change")||h.reset(g)}function l(e,t,n,o,i){var u=e.$value,s=e.$touched,a=e.onChange,l=e.changed,d=e.name,f=e.reset,c=e.resetValue,v=e.filter;s.on(l,(function(){return!0})).reset(f,n,o),r.guard({source:a,filter:v||function(){return!0},target:l}),u.on(l,(function(e,r){return r})).on(t,(function(e,r){return r.hasOwnProperty(d)?r[d]:e})).reset(f,c,i,n)}function d(e){var r=t.useStore(e.$value),n=t.useStore(e.$errors),o=t.useStore(e.$firstError),i=t.useStore(e.$isValid),u=t.useStore(e.$isDirty),s=t.useStore(e.$touched);return{name:e.name,value:r,errors:n,firstError:o,isValid:i,isDirty:u,touched:s,isTouched:s,onChange:e.onChange,onBlur:e.onBlur,addError:e.addError,validate:e.validate,reset:e.reset,set:e.onChange,resetErrors:e.resetErrors,hasError:function(){return null!==o},errorText:function(e){return o?e&&e[o.rule]?e[o.rule]:o.errorText||"":""}}}e.createForm=function(e){var t=e.filter,n=e.domain,o=e.fields,i=e.validateOn,d=e.units,f={},c=[],v=[];for(var m in o)if(o.hasOwnProperty(m)){var p=s(m,o[m],n);f[m]=p,c.push(p.$isDirty),v.push(p.$touched)}var h=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n].$value);return r.combine(t)}(f),y=function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var o=e[n].$firstError;t.push(o)}return r.combine(t).map((function(e){return e.every((function(e){return null===e}))}))}(f),g=t?r.combine(y,t,(function(e,r){return e&&r})):y,b=r.combine(c).map((function(e){return e.some(Boolean)})),E=r.combine(v).map((function(e){return e.some(Boolean)})),$=u.event({domain:n,existing:null==d?void 0:d.validate}),x=u.event({domain:n,existing:null==d?void 0:d.submit}),V=u.event({domain:n,existing:null==d?void 0:d.formValidated}),S=u.event({domain:n,existing:null==d?void 0:d.setForm}),T=u.event({domain:n,existing:null==d?void 0:d.reset}),F=u.event({domain:n,existing:null==d?void 0:d.resetValues}),O=u.event({domain:n,existing:null==d?void 0:d.resetErrors}),w=u.event({domain:n,existing:null==d?void 0:d.resetTouched}),B=r.sample(h,x),j=r.sample(h,$);for(var A in f)if(f.hasOwnProperty(A)){var C=o[A],D=f[A];l(D,S,T,w,F),C.rules&&a({$form:h,rules:C.rules,submitEvent:x,resetFormEvent:T,resetValues:F,resetErrors:O,validateFormEvent:$,field:D,formValidationEvents:i||["submit"],fieldValidationEvents:C.validateOn?C.validateOn:[]})}return r.guard({source:B,filter:g,target:V}),r.guard({source:j,filter:g,target:V}),{fields:f,$values:h,$eachValid:y,$isValid:y,$isDirty:b,$touched:E,submit:x,validate:$,resetTouched:w,reset:T,resetValues:F,resetErrors:O,setForm:S,set:S,formValidated:V}},e.useField=d,e.useForm=function(e){var r={};for(var n in e.fields)if(e.fields.hasOwnProperty(n)){var o=e.fields[n];r[n]=d(o)}var i=t.useStore(e.$values),u=t.useStore(e.$eachValid),s=t.useStore(e.$isDirty),a=t.useStore(e.$touched);return{fields:r,values:i,hasError:function(e){return e?!!r[e]&&Boolean(r[e].firstError):!u},eachValid:u,isValid:u,isDirty:s,isTouched:a,touched:a,errors:function(e){return r[e]?r[e].errors:[]},error:function(e){return r[e]?r[e].firstError:null},reset:e.reset,errorText:function(e,t){var n=r[e];return n&&n.firstError?t&&t[n.firstError.rule]?t[n.firstError.rule]:n.firstError.errorText||"":""},submit:e.submit,setForm:e.setForm,set:e.setForm,formValidated:e.formValidated}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=effector-forms.umd.js.map
