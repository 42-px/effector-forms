{"version":3,"file":"effector-form.iife.js","sources":["../src/factory.ts"],"sourcesContent":["import {\n    Effect,\n    Store,\n    Domain,\n    createStore\n} from \"effector\"\n\ntype UnknownObject<T = unknown> = {\n  [key: string]: T\n}\n\nexport type Validator<Value> = (v: Value) => boolean\n\nexport type Rule<Value> = {\n  name: string\n  validator: Validator<Value>\n}\n\ntype InitFunc<Value> = () => Value\n\nexport type FieldConfig<Value> = {\n  init: Value | InitFunc<Value>\n  rules?: Rule<Value>[]\n  validateOn?: ValidationEvent\n}\n\ntype ValidationEvent = \"submit\" | \"blur\" | \"change\"\n\ntype FormConfig<Fields extends UnknownObject, Done, Fail, Error> = {\n  fields: Fields\n  submitFx: Effect<Done, Fail, Error>\n  domain?: Domain \n  validateOn?: ValidationEvent\n}\n\nexport function createFieldsStores<Fields extends UnknownObject>(\n    fields: Fields, domain?: Domain\n) {\n    const stores = {} as {\n      [K in keyof Fields]: Fields[K] extends FieldConfig<infer U>\n        ? Store<U> \n        : Fields[K];\n    }\n\n    for (const fieldName in fields) {\n        if (!fields.hasOwnProperty(fieldName)) continue\n\n        const field = fields[fieldName] as FieldConfig<any>\n        const value = typeof field.init === \"function\"\n            ? field.init()\n            : field.init\n\n    ;(stores as any)[fieldName] = domain\n            ? domain.store<any>(value)\n            : createStore<any>(value) \n    }\n\n    return stores\n}\n\n\nexport function createForm<Fields extends UnknownObject, Done, Fail, Error>(\n    config: FormConfig<Fields, Done, Fail, Error>\n) {\n    const {\n        domain,\n        fields,\n        submitFx,\n        validateOn = \"submit\"\n    } = config\n\n    /*\n    let f: {\n      [K in keyof Fields]: Fields[K] extends FieldConfig<infer U>\n        ? U\n        : Fields[K]\n    }\n\n\n    return f\n    */\n}\n\n\n/*\nconst f = createForm({\n  username: {\n    init: \"\",\n    rules: [\n      {\n        name: 'required',\n        validator: (name: string) => Boolean(name), \n      }\n    ],\n  }\n})\n*/\n\n// массивом лучше \n"],"names":["fields","domain","stores","fieldName","hasOwnProperty","field","value","init","store","createStore","config"],"mappings":"iFAoCIA,EAAgBC,GAEhB,MAAMC,EAAS,GAMf,IAAK,MAAMC,KAAaH,EAAQ,CAC5B,IAAKA,EAAOI,eAAeD,GAAY,SAEvC,MAAME,EAAQL,EAAOG,GACfG,EAA8B,mBAAfD,EAAME,KACrBF,EAAME,OACNF,EAAME,KAEdL,EAAeC,GAAaF,EACpBA,EAAOO,MAAWF,GAClBG,cAAiBH,GAG3B,OAAOJ,yBAKPQ"}